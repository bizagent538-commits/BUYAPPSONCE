<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ViolationTrack - Demo</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      --primary: #dc2626;
      --primary-dark: #b91c1c;
      --primary-light: #fef2f2;
      --success: #10b981;
      --warning: #f59e0b;
      --info: #3b82f6;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--gray-100);
      color: var(--gray-800);
      line-height: 1.5;
    }
    
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header h1 { font-size: 1.5rem; font-weight: 600; }
    
    .demo-badge {
      background: var(--warning);
      color: var(--gray-800);
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .nav-tabs {
      background: white;
      display: flex;
      border-bottom: 1px solid var(--gray-200);
      padding: 0 1rem;
      overflow-x: auto;
    }
    
    .nav-tab {
      padding: 1rem 1.5rem;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      font-weight: 500;
      color: var(--gray-500);
      white-space: nowrap;
    }
    
    .nav-tab:hover { color: var(--gray-700); }
    .nav-tab.active { color: var(--primary); border-bottom-color: var(--primary); }
    
    .main-content { max-width: 1400px; margin: 0 auto; padding: 1.5rem; }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .stat-card {
      background: white;
      padding: 1.25rem;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .stat-value { font-size: 1.5rem; font-weight: 700; }
    .stat-value.red { color: var(--primary); }
    .stat-value.yellow { color: var(--warning); }
    .stat-value.green { color: var(--success); }
    .stat-value.blue { color: var(--info); }
    .stat-label { font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase; margin-top: 0.25rem; }
    
    .card {
      background: white;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .card-title { font-size: 1.125rem; font-weight: 600; }
    
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      font-weight: 500;
      cursor: pointer;
      border: none;
      font-size: 0.875rem;
    }
    
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-success { background: var(--success); color: white; }
    .btn-warning { background: var(--warning); color: white; }
    .btn-info { background: var(--info); color: white; }
    .btn-secondary { background: var(--gray-200); color: var(--gray-700); }
    .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.75rem; }
    
    .filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    
    .filter-select, .filter-input {
      padding: 0.5rem;
      border: 1px solid var(--gray-300);
      border-radius: 0.375rem;
      font-size: 0.875rem;
    }
    
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--gray-200); }
    th { font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--gray-500); background: var(--gray-50); }
    tr:hover { background: var(--gray-50); }
    
    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .status-badge.open { background: #fee2e2; color: #991b1b; }
    .status-badge.investigating { background: #fef3c7; color: #92400e; }
    .status-badge.resolved { background: #dcfce7; color: #166534; }
    .status-badge.closed { background: var(--gray-200); color: var(--gray-600); }
    .status-badge.pending { background: #dbeafe; color: #1e40af; }
    
    .severity-badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .severity-badge.critical { background: #dc2626; color: white; }
    .severity-badge.major { background: #f97316; color: white; }
    .severity-badge.minor { background: #eab308; color: white; }
    .severity-badge.warning { background: #22c55e; color: white; }
    
    .type-badge {
      display: inline-block;
      padding: 0.125rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.7rem;
      font-weight: 500;
      background: var(--gray-100);
      color: var(--gray-700);
    }
    
    .violation-card {
      background: var(--gray-50);
      border-radius: 0.375rem;
      padding: 1rem;
      margin-bottom: 0.75rem;
      border-left: 4px solid var(--gray-300);
    }
    
    .violation-card.critical { border-left-color: #dc2626; }
    .violation-card.major { border-left-color: #f97316; }
    .violation-card.minor { border-left-color: #eab308; }
    .violation-card.warning { border-left-color: #22c55e; }
    
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
    
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal-overlay.active { display: flex; }
    
    .modal {
      background: white;
      border-radius: 0.5rem;
      width: 100%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--gray-200);
    }
    
    .modal-title { font-size: 1.125rem; font-weight: 600; }
    .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray-400); }
    .modal-body { padding: 1.5rem; }
    
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--gray-200);
      background: var(--gray-50);
    }
    
    .form-group { margin-bottom: 1rem; }
    .form-label { display: block; font-weight: 500; margin-bottom: 0.5rem; font-size: 0.875rem; }
    
    .form-input {
      width: 100%;
      padding: 0.625rem 0.75rem;
      border: 1px solid var(--gray-300);
      border-radius: 0.375rem;
      font-size: 0.875rem;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
    }
    
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    
    .toast-container { position: fixed; bottom: 1rem; right: 1rem; z-index: 2000; }
    
    .toast {
      background: var(--gray-800);
      color: white;
      padding: 0.75rem 1rem;
      border-radius: 0.375rem;
      margin-top: 0.5rem;
      animation: slideIn 0.3s ease;
    }
    
    .toast.success { background: var(--success); }
    .toast.error { background: var(--primary); }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @media (max-width: 768px) {
      .form-row, .grid-2 { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header class="header">
    <h1>üö´ ViolationTrack</h1>
    <span class="demo-badge">Demo Mode</span>
  </header>
  
  <nav class="nav-tabs">
    <div class="nav-tab active" data-tab="dashboard">Dashboard</div>
    <div class="nav-tab" data-tab="violations">Violations</div>
    <div class="nav-tab" data-tab="people">People</div>
    <div class="nav-tab" data-tab="reports">Reports</div>
  </nav>
  
  <main class="main-content">
    <!-- Dashboard -->
    <div class="tab-content active" id="tab-dashboard">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value red" id="stat-open">0</div>
          <div class="stat-label">Open Violations</div>
        </div>
        <div class="stat-card">
          <div class="stat-value yellow" id="stat-investigating">0</div>
          <div class="stat-label">Investigating</div>
        </div>
        <div class="stat-card">
          <div class="stat-value green" id="stat-resolved">0</div>
          <div class="stat-label">Resolved (30 days)</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-total">0</div>
          <div class="stat-label">Total This Year</div>
        </div>
      </div>
      
      <div class="grid-2">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">üö® Open Violations</h2>
            <button class="btn btn-primary btn-sm" onclick="openViolationModal()">+ Report</button>
          </div>
          <div id="open-violations"></div>
        </div>
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">‚è∞ Pending Actions</h2>
          </div>
          <div id="pending-actions"></div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">üìä Violations by Type</h2>
        </div>
        <div id="type-chart"></div>
      </div>
    </div>
    
    <!-- Violations -->
    <div class="tab-content" id="tab-violations">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">All Violations</h2>
          <div style="display: flex; gap: 0.5rem;">
            <button class="btn btn-secondary" onclick="exportViolations()">Export</button>
            <button class="btn btn-primary" onclick="openViolationModal()">+ Report Violation</button>
          </div>
        </div>
        <div class="filters">
          <select class="filter-select" id="filter-status" onchange="renderViolations()">
            <option value="">All Statuses</option>
            <option value="open">Open</option>
            <option value="investigating">Investigating</option>
            <option value="resolved">Resolved</option>
            <option value="closed">Closed</option>
          </select>
          <select class="filter-select" id="filter-severity" onchange="renderViolations()">
            <option value="">All Severities</option>
            <option value="critical">Critical</option>
            <option value="major">Major</option>
            <option value="minor">Minor</option>
            <option value="warning">Warning</option>
          </select>
          <select class="filter-select" id="filter-type" onchange="renderViolations()">
            <option value="">All Types</option>
          </select>
          <input type="text" class="filter-input" placeholder="Search..." id="filter-search" oninput="renderViolations()">
        </div>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Date</th>
              <th>Type</th>
              <th>Description</th>
              <th>Person</th>
              <th>Severity</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="violations-table"></tbody>
        </table>
      </div>
    </div>
    
    <!-- People -->
    <div class="tab-content" id="tab-people">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">People</h2>
          <button class="btn btn-primary" onclick="openPersonModal()">+ Add Person</button>
        </div>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Department</th>
              <th>Email</th>
              <th>Total Violations</th>
              <th>Open</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="people-table"></tbody>
        </table>
      </div>
    </div>
    
    <!-- Reports -->
    <div class="tab-content" id="tab-reports">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">üìä Reports & Analytics</h2>
        </div>
        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap; margin-bottom: 1.5rem;">
          <button class="btn btn-primary" onclick="exportViolations()">üìã All Violations</button>
          <button class="btn btn-secondary" onclick="exportByPerson()">üë§ By Person</button>
          <button class="btn btn-secondary" onclick="exportByType()">üìÅ By Type</button>
        </div>
        
        <h3 style="margin-bottom: 1rem;">Monthly Trend</h3>
        <div id="monthly-chart" style="display: flex; align-items: flex-end; gap: 0.5rem; height: 150px; margin-bottom: 2rem;"></div>
        
        <h3 style="margin-bottom: 1rem;">By Severity</h3>
        <div id="severity-chart" style="margin-bottom: 2rem;"></div>
        
        <h3 style="margin-bottom: 1rem;">Top Offenders</h3>
        <div id="offenders-list"></div>
      </div>
    </div>
  </main>
  
  <!-- Violation Modal -->
  <div class="modal-overlay" id="violation-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="violation-modal-title">Report Violation</h3>
        <button class="modal-close" onclick="closeModal('violation-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="vio-id">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date *</label>
            <input type="date" class="form-input" id="vio-date">
          </div>
          <div class="form-group">
            <label class="form-label">Time</label>
            <input type="time" class="form-input" id="vio-time">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Violation Type *</label>
            <select class="form-input" id="vio-type">
              <option value="policy">Policy Violation</option>
              <option value="safety">Safety Violation</option>
              <option value="conduct">Conduct Issue</option>
              <option value="attendance">Attendance</option>
              <option value="performance">Performance</option>
              <option value="harassment">Harassment</option>
              <option value="theft">Theft/Fraud</option>
              <option value="substance">Substance Abuse</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Severity *</label>
            <select class="form-input" id="vio-severity">
              <option value="warning">Warning</option>
              <option value="minor">Minor</option>
              <option value="major">Major</option>
              <option value="critical">Critical</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Person Involved *</label>
          <select class="form-input" id="vio-person"></select>
        </div>
        <div class="form-group">
          <label class="form-label">Location</label>
          <input type="text" class="form-input" id="vio-location" placeholder="Where did this occur?">
        </div>
        <div class="form-group">
          <label class="form-label">Description *</label>
          <textarea class="form-input" id="vio-description" rows="3" placeholder="Describe the violation in detail..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Witnesses</label>
          <input type="text" class="form-input" id="vio-witnesses" placeholder="Names of any witnesses">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Reported By</label>
            <input type="text" class="form-input" id="vio-reporter">
          </div>
          <div class="form-group">
            <label class="form-label">Status</label>
            <select class="form-input" id="vio-status">
              <option value="open">Open</option>
              <option value="investigating">Investigating</option>
              <option value="resolved">Resolved</option>
              <option value="closed">Closed</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Corrective Action</label>
          <textarea class="form-input" id="vio-action" rows="2" placeholder="Action taken or required..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Action Due Date</label>
          <input type="date" class="form-input" id="vio-due">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="vio-delete-btn" onclick="deleteViolation()" style="margin-right:auto;display:none;">Delete</button>
        <button class="btn btn-secondary" onclick="closeModal('violation-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveViolation()">Save</button>
      </div>
    </div>
  </div>
  
  <!-- Person Modal -->
  <div class="modal-overlay" id="person-modal">
    <div class="modal" style="max-width: 450px;">
      <div class="modal-header">
        <h3 class="modal-title" id="person-modal-title">Add Person</h3>
        <button class="modal-close" onclick="closeModal('person-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="per-id">
        <div class="form-group">
          <label class="form-label">Name *</label>
          <input type="text" class="form-input" id="per-name">
        </div>
        <div class="form-group">
          <label class="form-label">Department</label>
          <input type="text" class="form-input" id="per-department">
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="per-email">
        </div>
        <div class="form-group">
          <label class="form-label">Employee ID</label>
          <input type="text" class="form-input" id="per-empid">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="per-delete-btn" onclick="deletePerson()" style="margin-right:auto;display:none;">Delete</button>
        <button class="btn btn-secondary" onclick="closeModal('person-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="savePerson()">Save</button>
      </div>
    </div>
  </div>
  
  <div class="toast-container" id="toast-container"></div>

  <script>
    let violations = [];
    let people = [];
    
    const violationTypes = [
      { value: 'policy', label: 'Policy Violation' },
      { value: 'safety', label: 'Safety Violation' },
      { value: 'conduct', label: 'Conduct Issue' },
      { value: 'attendance', label: 'Attendance' },
      { value: 'performance', label: 'Performance' },
      { value: 'harassment', label: 'Harassment' },
      { value: 'theft', label: 'Theft/Fraud' },
      { value: 'substance', label: 'Substance Abuse' },
      { value: 'other', label: 'Other' }
    ];
    
    function init() {
      loadData();
      setupTabs();
      renderAll();
    }
    
    function loadData() {
      const saved = {
        violations: localStorage.getItem('violationtrack_violations'),
        people: localStorage.getItem('violationtrack_people')
      };
      
      people = saved.people ? JSON.parse(saved.people) : [
        { id: 1, name: 'John Smith', department: 'Operations', email: 'john.smith@company.com', empid: 'EMP001' },
        { id: 2, name: 'Sarah Johnson', department: 'Sales', email: 'sarah.j@company.com', empid: 'EMP002' },
        { id: 3, name: 'Mike Williams', department: 'Warehouse', email: 'mike.w@company.com', empid: 'EMP003' },
        { id: 4, name: 'Emily Brown', department: 'Customer Service', email: 'emily.b@company.com', empid: 'EMP004' },
        { id: 5, name: 'David Lee', department: 'IT', email: 'david.l@company.com', empid: 'EMP005' },
      ];
      
      const today = new Date();
      const lastWeek = new Date(today.getTime() - 7 * 86400000).toISOString().split('T')[0];
      const twoWeeksAgo = new Date(today.getTime() - 14 * 86400000).toISOString().split('T')[0];
      const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 15).toISOString().split('T')[0];
      const twoMonthsAgo = new Date(today.getFullYear(), today.getMonth() - 2, 10).toISOString().split('T')[0];
      const nextWeek = new Date(today.getTime() + 7 * 86400000).toISOString().split('T')[0];
      
      violations = saved.violations ? JSON.parse(saved.violations) : [
        { id: 1, date: lastWeek, time: '09:30', type: 'attendance', severity: 'minor', personId: 2, location: 'Main Office', description: 'Late arrival without notification - 45 minutes late', witnesses: '', reporter: 'Manager', status: 'open', action: 'Verbal warning issued', dueDate: nextWeek },
        { id: 2, date: twoWeeksAgo, time: '14:15', type: 'safety', severity: 'major', personId: 3, location: 'Warehouse', description: 'Failed to wear required PPE in designated area', witnesses: 'Tom Harris', reporter: 'Safety Officer', status: 'resolved', action: 'Written warning, mandatory safety refresher training', dueDate: null },
        { id: 3, date: lastMonth, time: '11:00', type: 'policy', severity: 'minor', personId: 1, location: 'Break Room', description: 'Unauthorized use of company equipment for personal use', witnesses: '', reporter: 'IT Department', status: 'closed', action: 'Reminded of policy, no further action', dueDate: null },
        { id: 4, date: lastWeek, time: '16:30', type: 'conduct', severity: 'warning', personId: 4, location: 'Customer Area', description: 'Minor unprofessional language during customer interaction', witnesses: 'Lisa Park', reporter: 'Supervisor', status: 'investigating', action: '', dueDate: nextWeek },
        { id: 5, date: twoMonthsAgo, time: '08:45', type: 'attendance', severity: 'major', personId: 2, location: '', description: 'Third unexcused absence this quarter', witnesses: '', reporter: 'HR', status: 'resolved', action: 'Final written warning issued', dueDate: null },
      ];
      
      saveData();
    }
    
    function saveData() {
      localStorage.setItem('violationtrack_violations', JSON.stringify(violations));
      localStorage.setItem('violationtrack_people', JSON.stringify(people));
    }
    
    function setupTabs() {
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', function() {
          document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          this.classList.add('active');
          document.getElementById('tab-' + this.dataset.tab).classList.add('active');
        });
      });
    }
    
    function renderAll() {
      renderDashboard();
      renderViolations();
      renderPeople();
      renderReports();
      updateSelects();
    }
    
    function updateSelects() {
      const personOpts = '<option value="">Select Person</option>' + people.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
      document.getElementById('vio-person').innerHTML = personOpts;
      
      const typeOpts = '<option value="">All Types</option>' + violationTypes.map(t => `<option value="${t.value}">${t.label}</option>`).join('');
      document.getElementById('filter-type').innerHTML = typeOpts;
    }
    
    // Dashboard
    function renderDashboard() {
      const thirtyDaysAgo = new Date(Date.now() - 30 * 86400000).toISOString().split('T')[0];
      const thisYear = new Date().getFullYear();
      
      const openCount = violations.filter(v => v.status === 'open').length;
      const investigatingCount = violations.filter(v => v.status === 'investigating').length;
      const resolvedCount = violations.filter(v => (v.status === 'resolved' || v.status === 'closed') && v.date >= thirtyDaysAgo).length;
      const yearTotal = violations.filter(v => new Date(v.date).getFullYear() === thisYear).length;
      
      document.getElementById('stat-open').textContent = openCount;
      document.getElementById('stat-investigating').textContent = investigatingCount;
      document.getElementById('stat-resolved').textContent = resolvedCount;
      document.getElementById('stat-total').textContent = yearTotal;
      
      // Open violations
      const openViolations = violations.filter(v => v.status === 'open' || v.status === 'investigating').slice(0, 5);
      document.getElementById('open-violations').innerHTML = openViolations.length ? openViolations.map(v => {
        const person = people.find(p => p.id === v.personId);
        const typeLabel = violationTypes.find(t => t.value === v.type)?.label || v.type;
        return `<div class="violation-card ${v.severity}">
          <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
              <div style="font-weight: 500;">${typeLabel}</div>
              <div style="font-size: 0.875rem; color: var(--gray-500);">${person?.name || 'Unknown'} ‚Ä¢ ${formatDate(v.date)}</div>
            </div>
            <div>
              <span class="severity-badge ${v.severity}">${v.severity}</span>
            </div>
          </div>
        </div>`;
      }).join('') : '<div style="text-align:center;color:var(--gray-500);padding:2rem;">No open violations üëç</div>';
      
      // Pending actions
      const today = new Date().toISOString().split('T')[0];
      const pending = violations.filter(v => v.dueDate && v.status !== 'closed' && v.status !== 'resolved').sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate)).slice(0, 5);
      
      document.getElementById('pending-actions').innerHTML = pending.length ? pending.map(v => {
        const person = people.find(p => p.id === v.personId);
        const isOverdue = v.dueDate < today;
        const daysLeft = Math.ceil((new Date(v.dueDate) - new Date()) / 86400000);
        
        return `<div class="violation-card ${isOverdue ? 'critical' : ''}">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <div style="font-weight: 500;">${v.action || 'Pending action'}</div>
              <div style="font-size: 0.875rem; color: var(--gray-500);">${person?.name || 'Unknown'}</div>
            </div>
            <div style="text-align: right;">
              <div style="${isOverdue ? 'color: var(--primary);' : ''} font-weight: 600;">${isOverdue ? 'Overdue' : daysLeft + ' days'}</div>
              <div style="font-size: 0.875rem;">Due ${formatDate(v.dueDate)}</div>
            </div>
          </div>
        </div>`;
      }).join('') : '<div style="text-align:center;color:var(--gray-500);padding:2rem;">No pending actions</div>';
      
      // Type chart
      const typeCounts = violationTypes.map(t => ({
        label: t.label,
        count: violations.filter(v => v.type === t.value).length
      })).filter(t => t.count > 0);
      
      const maxType = Math.max(...typeCounts.map(t => t.count), 1);
      
      document.getElementById('type-chart').innerHTML = typeCounts.map(t => `
        <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
          <span style="width: 140px; font-size: 0.875rem;">${t.label}</span>
          <div style="flex: 1; height: 24px; background: var(--gray-200); border-radius: 4px; margin: 0 1rem;">
            <div style="width: ${t.count / maxType * 100}%; height: 100%; background: var(--primary); border-radius: 4px;"></div>
          </div>
          <span style="width: 30px; text-align: right; font-weight: 600;">${t.count}</span>
        </div>
      `).join('');
    }
    
    // Violations
    function renderViolations() {
      const statusFilter = document.getElementById('filter-status').value;
      const severityFilter = document.getElementById('filter-severity').value;
      const typeFilter = document.getElementById('filter-type').value;
      const search = document.getElementById('filter-search').value.toLowerCase();
      
      let filtered = [...violations];
      if (statusFilter) filtered = filtered.filter(v => v.status === statusFilter);
      if (severityFilter) filtered = filtered.filter(v => v.severity === severityFilter);
      if (typeFilter) filtered = filtered.filter(v => v.type === typeFilter);
      if (search) {
        filtered = filtered.filter(v => {
          const person = people.find(p => p.id === v.personId);
          return v.description.toLowerCase().includes(search) || person?.name.toLowerCase().includes(search);
        });
      }
      
      filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      document.getElementById('violations-table').innerHTML = filtered.map(v => {
        const person = people.find(p => p.id === v.personId);
        const typeLabel = violationTypes.find(t => t.value === v.type)?.label || v.type;
        
        return `<tr>
          <td><strong>VIO-${String(v.id).padStart(4, '0')}</strong></td>
          <td>${formatDate(v.date)}</td>
          <td><span class="type-badge">${typeLabel}</span></td>
          <td>${v.description.substring(0, 40)}${v.description.length > 40 ? '...' : ''}</td>
          <td>${person?.name || 'Unknown'}</td>
          <td><span class="severity-badge ${v.severity}">${v.severity}</span></td>
          <td><span class="status-badge ${v.status}">${v.status}</span></td>
          <td><button class="btn btn-sm btn-secondary" onclick="openViolationModal(${v.id})">View</button></td>
        </tr>`;
      }).join('');
    }
    
    function openViolationModal(id) {
      const today = new Date().toISOString().split('T')[0];
      
      if (id) {
        const v = violations.find(x => x.id === id);
        document.getElementById('violation-modal-title').textContent = 'Edit Violation';
        document.getElementById('vio-id').value = id;
        document.getElementById('vio-date').value = v.date;
        document.getElementById('vio-time').value = v.time || '';
        document.getElementById('vio-type').value = v.type;
        document.getElementById('vio-severity').value = v.severity;
        document.getElementById('vio-person').value = v.personId;
        document.getElementById('vio-location').value = v.location || '';
        document.getElementById('vio-description').value = v.description;
        document.getElementById('vio-witnesses').value = v.witnesses || '';
        document.getElementById('vio-reporter').value = v.reporter || '';
        document.getElementById('vio-status').value = v.status;
        document.getElementById('vio-action').value = v.action || '';
        document.getElementById('vio-due').value = v.dueDate || '';
        document.getElementById('vio-delete-btn').style.display = 'block';
      } else {
        document.getElementById('violation-modal-title').textContent = 'Report Violation';
        document.getElementById('vio-id').value = '';
        document.getElementById('vio-date').value = today;
        document.getElementById('vio-time').value = '';
        document.getElementById('vio-type').value = 'policy';
        document.getElementById('vio-severity').value = 'minor';
        document.getElementById('vio-person').value = '';
        document.getElementById('vio-location').value = '';
        document.getElementById('vio-description').value = '';
        document.getElementById('vio-witnesses').value = '';
        document.getElementById('vio-reporter').value = '';
        document.getElementById('vio-status').value = 'open';
        document.getElementById('vio-action').value = '';
        document.getElementById('vio-due').value = '';
        document.getElementById('vio-delete-btn').style.display = 'none';
      }
      document.getElementById('violation-modal').classList.add('active');
    }
    
    function saveViolation() {
      const id = document.getElementById('vio-id').value;
      const date = document.getElementById('vio-date').value;
      const time = document.getElementById('vio-time').value;
      const type = document.getElementById('vio-type').value;
      const severity = document.getElementById('vio-severity').value;
      const personId = parseInt(document.getElementById('vio-person').value);
      const location = document.getElementById('vio-location').value.trim();
      const description = document.getElementById('vio-description').value.trim();
      const witnesses = document.getElementById('vio-witnesses').value.trim();
      const reporter = document.getElementById('vio-reporter').value.trim();
      const status = document.getElementById('vio-status').value;
      const action = document.getElementById('vio-action').value.trim();
      const dueDate = document.getElementById('vio-due').value || null;
      
      if (!date || !personId || !description) {
        showToast('Please fill required fields', 'error');
        return;
      }
      
      if (id) {
        const i = violations.findIndex(v => v.id === parseInt(id));
        violations[i] = { ...violations[i], date, time, type, severity, personId, location, description, witnesses, reporter, status, action, dueDate };
        showToast('Violation updated');
      } else {
        violations.push({
          id: Math.max(0, ...violations.map(v => v.id)) + 1,
          date, time, type, severity, personId, location, description, witnesses, reporter, status, action, dueDate
        });
        showToast('Violation reported');
      }
      
      saveData();
      renderAll();
      closeModal('violation-modal');
    }
    
    function deleteViolation() {
      const id = parseInt(document.getElementById('vio-id').value);
      if (!confirm('Delete this violation record?')) return;
      violations = violations.filter(v => v.id !== id);
      saveData();
      renderAll();
      closeModal('violation-modal');
      showToast('Violation deleted');
    }
    
    // People
    function renderPeople() {
      document.getElementById('people-table').innerHTML = people.map(p => {
        const personViolations = violations.filter(v => v.personId === p.id);
        const openCount = personViolations.filter(v => v.status === 'open' || v.status === 'investigating').length;
        
        return `<tr>
          <td><strong>${p.name}</strong></td>
          <td>${p.department || '-'}</td>
          <td>${p.email || '-'}</td>
          <td>${personViolations.length}</td>
          <td>${openCount > 0 ? `<span style="color: var(--primary); font-weight: 600;">${openCount}</span>` : '0'}</td>
          <td><button class="btn btn-sm btn-secondary" onclick="openPersonModal(${p.id})">Edit</button></td>
        </tr>`;
      }).join('');
    }
    
    function openPersonModal(id) {
      if (id) {
        const p = people.find(x => x.id === id);
        document.getElementById('person-modal-title').textContent = 'Edit Person';
        document.getElementById('per-id').value = id;
        document.getElementById('per-name').value = p.name;
        document.getElementById('per-department').value = p.department || '';
        document.getElementById('per-email').value = p.email || '';
        document.getElementById('per-empid').value = p.empid || '';
        document.getElementById('per-delete-btn').style.display = 'block';
      } else {
        document.getElementById('person-modal-title').textContent = 'Add Person';
        document.getElementById('per-id').value = '';
        document.getElementById('per-name').value = '';
        document.getElementById('per-department').value = '';
        document.getElementById('per-email').value = '';
        document.getElementById('per-empid').value = '';
        document.getElementById('per-delete-btn').style.display = 'none';
      }
      document.getElementById('person-modal').classList.add('active');
    }
    
    function savePerson() {
      const id = document.getElementById('per-id').value;
      const name = document.getElementById('per-name').value.trim();
      const department = document.getElementById('per-department').value.trim();
      const email = document.getElementById('per-email').value.trim();
      const empid = document.getElementById('per-empid').value.trim();
      
      if (!name) {
        showToast('Please enter a name', 'error');
        return;
      }
      
      if (id) {
        const i = people.findIndex(p => p.id === parseInt(id));
        people[i] = { ...people[i], name, department, email, empid };
        showToast('Person updated');
      } else {
        people.push({
          id: Math.max(0, ...people.map(p => p.id)) + 1,
          name, department, email, empid
        });
        showToast('Person added');
      }
      
      saveData();
      renderAll();
      closeModal('person-modal');
    }
    
    function deletePerson() {
      const id = parseInt(document.getElementById('per-id').value);
      const hasViolations = violations.some(v => v.personId === id);
      
      if (hasViolations && !confirm('This person has violation records. Delete anyway?')) return;
      
      people = people.filter(p => p.id !== id);
      saveData();
      renderAll();
      closeModal('person-modal');
      showToast('Person deleted');
    }
    
    // Reports
    function renderReports() {
      // Monthly trend
      const months = [];
      for (let i = 11; i >= 0; i--) {
        const d = new Date();
        d.setMonth(d.getMonth() - i);
        months.push({
          key: `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`,
          label: d.toLocaleDateString('en-US', { month: 'short' })
        });
      }
      
      const monthlyData = months.map(m => ({
        label: m.label,
        count: violations.filter(v => v.date.startsWith(m.key)).length
      }));
      
      const maxMonth = Math.max(...monthlyData.map(m => m.count), 1);
      
      document.getElementById('monthly-chart').innerHTML = monthlyData.map(m => `
        <div style="flex: 1; text-align: center;">
          <div style="background: ${m.count > 0 ? 'var(--primary-light)' : 'var(--gray-100)'}; border: 1px solid ${m.count > 0 ? 'var(--primary)' : 'var(--gray-200)'}; border-radius: 4px 4px 0 0; height: ${m.count / maxMonth * 120}px; min-height: 4px;"></div>
          <div style="font-size: 0.65rem; color: var(--gray-500); margin-top: 0.25rem;">${m.label}</div>
        </div>
      `).join('');
      
      // Severity chart
      const severities = [
        { key: 'critical', label: 'Critical', color: '#dc2626' },
        { key: 'major', label: 'Major', color: '#f97316' },
        { key: 'minor', label: 'Minor', color: '#eab308' },
        { key: 'warning', label: 'Warning', color: '#22c55e' }
      ];
      
      const severityCounts = severities.map(s => ({
        ...s,
        count: violations.filter(v => v.severity === s.key).length
      }));
      
      const maxSev = Math.max(...severityCounts.map(s => s.count), 1);
      
      document.getElementById('severity-chart').innerHTML = severityCounts.map(s => `
        <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
          <span style="width: 80px; font-size: 0.875rem;">${s.label}</span>
          <div style="flex: 1; height: 24px; background: var(--gray-200); border-radius: 4px; margin: 0 1rem;">
            <div style="width: ${s.count / maxSev * 100}%; height: 100%; background: ${s.color}; border-radius: 4px;"></div>
          </div>
          <span style="width: 30px; text-align: right; font-weight: 600;">${s.count}</span>
        </div>
      `).join('');
      
      // Top offenders
      const offenderCounts = people.map(p => ({
        name: p.name,
        department: p.department,
        count: violations.filter(v => v.personId === p.id).length
      })).filter(o => o.count > 0).sort((a, b) => b.count - a.count).slice(0, 5);
      
      document.getElementById('offenders-list').innerHTML = offenderCounts.length ? offenderCounts.map((o, i) => `
        <div class="violation-card">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <div style="font-weight: 500;">${i + 1}. ${o.name}</div>
              <div style="font-size: 0.875rem; color: var(--gray-500);">${o.department || 'No department'}</div>
            </div>
            <div style="font-size: 1.25rem; font-weight: 700; color: var(--primary);">${o.count}</div>
          </div>
        </div>
      `).join('') : '<div style="text-align:center;color:var(--gray-500);padding:2rem;">No violations recorded</div>';
    }
    
    // Exports
    function exportViolations() {
      const headers = ['ID', 'Date', 'Time', 'Type', 'Severity', 'Person', 'Location', 'Description', 'Witnesses', 'Reporter', 'Status', 'Action', 'Due Date'];
      const rows = violations.map(v => {
        const person = people.find(p => p.id === v.personId);
        const typeLabel = violationTypes.find(t => t.value === v.type)?.label || v.type;
        return [
          'VIO-' + String(v.id).padStart(4, '0'),
          v.date, v.time || '', typeLabel, v.severity,
          person?.name || '', v.location || '', v.description,
          v.witnesses || '', v.reporter || '', v.status,
          v.action || '', v.dueDate || ''
        ];
      });
      downloadCSV([headers, ...rows], 'violations.csv');
      showToast('Violations exported');
    }
    
    function exportByPerson() {
      const headers = ['Name', 'Department', 'Email', 'Total Violations', 'Open', 'Critical', 'Major', 'Minor', 'Warning'];
      const rows = people.map(p => {
        const pv = violations.filter(v => v.personId === p.id);
        return [
          p.name, p.department || '', p.email || '',
          pv.length,
          pv.filter(v => v.status === 'open' || v.status === 'investigating').length,
          pv.filter(v => v.severity === 'critical').length,
          pv.filter(v => v.severity === 'major').length,
          pv.filter(v => v.severity === 'minor').length,
          pv.filter(v => v.severity === 'warning').length
        ];
      });
      downloadCSV([headers, ...rows], 'violations-by-person.csv');
      showToast('Report exported');
    }
    
    function exportByType() {
      const headers = ['Type', 'Total', 'Open', 'Investigating', 'Resolved', 'Closed'];
      const rows = violationTypes.map(t => {
        const tv = violations.filter(v => v.type === t.value);
        return [
          t.label, tv.length,
          tv.filter(v => v.status === 'open').length,
          tv.filter(v => v.status === 'investigating').length,
          tv.filter(v => v.status === 'resolved').length,
          tv.filter(v => v.status === 'closed').length
        ];
      });
      downloadCSV([headers, ...rows], 'violations-by-type.csv');
      showToast('Report exported');
    }
    
    function downloadCSV(data, filename) {
      const csv = data.map(r => r.map(c => `"${c}"`).join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      a.click();
    }
    
    function formatDate(d) {
      return d ? new Date(d + 'T00:00:00').toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : '';
    }
    
    function closeModal(id) {
      document.getElementById(id).classList.remove('active');
    }
    
    function showToast(msg, type) {
      type = type || 'success';
      const toast = document.createElement('div');
      toast.className = 'toast ' + type;
      toast.textContent = msg;
      document.getElementById('toast-container').appendChild(toast);
      setTimeout(function() { toast.remove(); }, 3000);
    }
    
    document.querySelectorAll('.modal-overlay').forEach(function(o) {
      o.addEventListener('click', function(e) {
        if (e.target === o) o.classList.remove('active');
      });
    });
    
    init();
  </script>
</body>
</html>
