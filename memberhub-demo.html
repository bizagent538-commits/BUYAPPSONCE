<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MemberHub - Demo</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      --primary: #7c3aed;
      --primary-dark: #6d28d9;
      --primary-light: #f5f3ff;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--gray-100);
      color: var(--gray-800);
      line-height: 1.5;
    }
    
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header h1 { font-size: 1.5rem; font-weight: 600; }
    
    .demo-badge {
      background: var(--warning);
      color: var(--gray-800);
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .nav-tabs {
      background: white;
      display: flex;
      border-bottom: 1px solid var(--gray-200);
      padding: 0 1rem;
      overflow-x: auto;
    }
    
    .nav-tab {
      padding: 1rem 1.5rem;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      font-weight: 500;
      color: var(--gray-500);
      white-space: nowrap;
    }
    
    .nav-tab:hover { color: var(--gray-700); }
    .nav-tab.active { color: var(--primary); border-bottom-color: var(--primary); }
    
    .main-content { max-width: 1400px; margin: 0 auto; padding: 1.5rem; }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .stat-card {
      background: white;
      padding: 1.25rem;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .stat-value { font-size: 1.75rem; font-weight: 700; }
    .stat-value.purple { color: var(--primary); }
    .stat-value.green { color: var(--success); }
    .stat-value.yellow { color: var(--warning); }
    .stat-value.red { color: var(--danger); }
    .stat-label { font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase; margin-top: 0.25rem; }
    
    .card {
      background: white;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .card-title { font-size: 1.125rem; font-weight: 600; }
    
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      font-weight: 500;
      cursor: pointer;
      border: none;
      font-size: 0.875rem;
    }
    
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-success { background: var(--success); color: white; }
    .btn-danger { background: var(--danger); color: white; }
    .btn-warning { background: var(--warning); color: white; }
    .btn-secondary { background: var(--gray-200); color: var(--gray-700); }
    .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.75rem; }
    
    .filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    
    .filter-select, .filter-input {
      padding: 0.5rem;
      border: 1px solid var(--gray-300);
      border-radius: 0.375rem;
      font-size: 0.875rem;
    }
    
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--gray-200); }
    th { font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--gray-500); background: var(--gray-50); }
    tr:hover { background: var(--gray-50); }
    
    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .status-badge.active { background: #dcfce7; color: #166534; }
    .status-badge.expired { background: #fee2e2; color: #991b1b; }
    .status-badge.pending { background: #fef3c7; color: #92400e; }
    .status-badge.cancelled { background: var(--gray-200); color: var(--gray-600); }
    .status-badge.grace { background: #dbeafe; color: #1e40af; }
    
    .tier-badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.7rem;
      font-weight: 600;
    }
    
    .tier-badge.gold { background: #fef3c7; color: #92400e; }
    .tier-badge.silver { background: #e5e7eb; color: #374151; }
    .tier-badge.bronze { background: #fed7aa; color: #9a3412; }
    .tier-badge.standard { background: var(--primary-light); color: var(--primary); }
    
    .member-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary-light);
      color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.875rem;
    }
    
    .member-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .member-info { flex: 1; }
    .member-name { font-weight: 600; }
    .member-email { font-size: 0.875rem; color: var(--gray-500); }
    
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
    .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; }
    
    .renewal-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--gray-200);
    }
    
    .renewal-item:last-child { border-bottom: none; }
    
    .payment-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      background: var(--gray-50);
      border-radius: 0.375rem;
      margin-bottom: 0.5rem;
    }
    
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal-overlay.active { display: flex; }
    
    .modal {
      background: white;
      border-radius: 0.5rem;
      width: 100%;
      max-width: 550px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--gray-200);
    }
    
    .modal-title { font-size: 1.125rem; font-weight: 600; }
    .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray-400); }
    .modal-body { padding: 1.5rem; }
    
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--gray-200);
      background: var(--gray-50);
    }
    
    .form-group { margin-bottom: 1rem; }
    .form-label { display: block; font-weight: 500; margin-bottom: 0.5rem; font-size: 0.875rem; }
    
    .form-input {
      width: 100%;
      padding: 0.625rem 0.75rem;
      border: 1px solid var(--gray-300);
      border-radius: 0.375rem;
      font-size: 0.875rem;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
    }
    
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    
    .tier-card {
      background: var(--gray-50);
      border: 2px solid var(--gray-200);
      border-radius: 0.5rem;
      padding: 1.25rem;
      text-align: center;
    }
    
    .tier-card.selected { border-color: var(--primary); background: var(--primary-light); }
    
    .tier-name { font-weight: 600; font-size: 1.125rem; margin-bottom: 0.25rem; }
    .tier-price { font-size: 1.5rem; font-weight: 700; color: var(--primary); }
    .tier-period { font-size: 0.75rem; color: var(--gray-500); }
    .tier-features { font-size: 0.875rem; color: var(--gray-600); margin-top: 0.5rem; }
    
    .empty-state { text-align: center; padding: 3rem; color: var(--gray-500); }
    
    .toast-container { position: fixed; bottom: 1rem; right: 1rem; z-index: 2000; }
    
    .toast {
      background: var(--gray-800);
      color: white;
      padding: 0.75rem 1rem;
      border-radius: 0.375rem;
      margin-top: 0.5rem;
      animation: slideIn 0.3s ease;
    }
    
    .toast.success { background: var(--success); }
    .toast.error { background: var(--danger); }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @media (max-width: 768px) {
      .form-row, .grid-2 { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header class="header">
    <h1>üë• MemberHub</h1>
    <span class="demo-badge">Demo Mode</span>
  </header>
  
  <nav class="nav-tabs">
    <div class="nav-tab active" data-tab="dashboard">Dashboard</div>
    <div class="nav-tab" data-tab="members">Members</div>
    <div class="nav-tab" data-tab="payments">Payments</div>
    <div class="nav-tab" data-tab="tiers">Membership Tiers</div>
    <div class="nav-tab" data-tab="reports">Reports</div>
  </nav>
  
  <main class="main-content">
    <!-- Dashboard -->
    <div class="tab-content active" id="tab-dashboard">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value purple" id="stat-total">0</div>
          <div class="stat-label">Total Members</div>
        </div>
        <div class="stat-card">
          <div class="stat-value green" id="stat-active">0</div>
          <div class="stat-label">Active</div>
        </div>
        <div class="stat-card">
          <div class="stat-value yellow" id="stat-expiring">0</div>
          <div class="stat-label">Expiring Soon</div>
        </div>
        <div class="stat-card">
          <div class="stat-value red" id="stat-expired">0</div>
          <div class="stat-label">Expired</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-revenue">$0</div>
          <div class="stat-label">YTD Revenue</div>
        </div>
      </div>
      
      <div class="grid-2">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">‚ö†Ô∏è Upcoming Renewals</h2>
          </div>
          <div id="upcoming-renewals"></div>
        </div>
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">üÜï Recent Members</h2>
          </div>
          <div id="recent-members"></div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">üìä Membership by Tier</h2>
        </div>
        <div id="tier-breakdown"></div>
      </div>
    </div>
    
    <!-- Members -->
    <div class="tab-content" id="tab-members">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Members</h2>
          <div style="display: flex; gap: 0.5rem;">
            <button class="btn btn-secondary" onclick="exportMembers()">Export</button>
            <button class="btn btn-primary" onclick="openMemberModal()">+ Add Member</button>
          </div>
        </div>
        <div class="filters">
          <select class="filter-select" id="filter-status" onchange="renderMembers()">
            <option value="">All Statuses</option>
            <option value="active">Active</option>
            <option value="expired">Expired</option>
            <option value="pending">Pending</option>
            <option value="cancelled">Cancelled</option>
          </select>
          <select class="filter-select" id="filter-tier" onchange="renderMembers()">
            <option value="">All Tiers</option>
          </select>
          <input type="text" class="filter-input" placeholder="Search members..." id="filter-search" oninput="renderMembers()">
        </div>
        <table>
          <thead>
            <tr>
              <th>Member</th>
              <th>Tier</th>
              <th>Join Date</th>
              <th>Expiration</th>
              <th>Status</th>
              <th>Balance</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="members-table"></tbody>
        </table>
      </div>
    </div>
    
    <!-- Payments -->
    <div class="tab-content" id="tab-payments">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Payment History</h2>
          <div style="display: flex; gap: 0.5rem;">
            <button class="btn btn-secondary" onclick="exportPayments()">Export</button>
            <button class="btn btn-primary" onclick="openPaymentModal()">+ Record Payment</button>
          </div>
        </div>
        <div class="filters">
          <select class="filter-select" id="filter-payment-type" onchange="renderPayments()">
            <option value="">All Types</option>
            <option value="dues">Dues</option>
            <option value="renewal">Renewal</option>
            <option value="initiation">Initiation Fee</option>
            <option value="other">Other</option>
          </select>
          <input type="month" class="filter-input" id="filter-payment-month" onchange="renderPayments()">
        </div>
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Member</th>
              <th>Type</th>
              <th>Amount</th>
              <th>Method</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody id="payments-table"></tbody>
        </table>
      </div>
    </div>
    
    <!-- Tiers -->
    <div class="tab-content" id="tab-tiers">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Membership Tiers</h2>
          <button class="btn btn-primary" onclick="openTierModal()">+ Add Tier</button>
        </div>
        <div class="grid-3" id="tiers-grid"></div>
      </div>
    </div>
    
    <!-- Reports -->
    <div class="tab-content" id="tab-reports">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">üìä Reports</h2>
        </div>
        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap; margin-bottom: 1.5rem;">
          <button class="btn btn-primary" onclick="exportMembers()">üë• Member Directory</button>
          <button class="btn btn-secondary" onclick="exportActive()">‚úÖ Active Members</button>
          <button class="btn btn-secondary" onclick="exportExpiring()">‚ö†Ô∏è Expiring Soon</button>
          <button class="btn btn-secondary" onclick="exportPayments()">üí∞ Payment History</button>
          <button class="btn btn-secondary" onclick="exportRevenue()">üìà Revenue Report</button>
        </div>
        
        <h3 style="margin-bottom: 1rem;">Monthly Revenue (This Year)</h3>
        <div id="revenue-chart" style="display: flex; align-items: flex-end; gap: 0.5rem; height: 200px; padding: 1rem 0;"></div>
        
        <h3 style="margin: 1.5rem 0 1rem;">Membership Statistics</h3>
        <div class="grid-3">
          <div class="stat-card">
            <div class="stat-value" id="stat-retention">0%</div>
            <div class="stat-label">Retention Rate</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="stat-avg-tenure">0</div>
            <div class="stat-label">Avg Tenure (months)</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="stat-new-ytd">0</div>
            <div class="stat-label">New Members YTD</div>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <!-- Member Modal -->
  <div class="modal-overlay" id="member-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="member-modal-title">Add Member</h3>
        <button class="modal-close" onclick="closeModal('member-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="mem-id">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">First Name *</label>
            <input type="text" class="form-input" id="mem-first">
          </div>
          <div class="form-group">
            <label class="form-label">Last Name *</label>
            <input type="text" class="form-input" id="mem-last">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Email *</label>
          <input type="email" class="form-input" id="mem-email">
        </div>
        <div class="form-group">
          <label class="form-label">Phone</label>
          <input type="tel" class="form-input" id="mem-phone">
        </div>
        <div class="form-group">
          <label class="form-label">Address</label>
          <input type="text" class="form-input" id="mem-address">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Membership Tier *</label>
            <select class="form-input" id="mem-tier"></select>
          </div>
          <div class="form-group">
            <label class="form-label">Status</label>
            <select class="form-input" id="mem-status">
              <option value="active">Active</option>
              <option value="pending">Pending</option>
              <option value="expired">Expired</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Join Date</label>
            <input type="date" class="form-input" id="mem-join">
          </div>
          <div class="form-group">
            <label class="form-label">Expiration Date</label>
            <input type="date" class="form-input" id="mem-expiration">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Notes</label>
          <textarea class="form-input" id="mem-notes" rows="2"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" id="mem-delete-btn" onclick="deleteMember()" style="margin-right:auto;display:none;">Delete</button>
        <button class="btn btn-secondary" onclick="closeModal('member-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveMember()">Save</button>
      </div>
    </div>
  </div>
  
  <!-- Payment Modal -->
  <div class="modal-overlay" id="payment-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Record Payment</h3>
        <button class="modal-close" onclick="closeModal('payment-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Member *</label>
          <select class="form-input" id="pay-member"></select>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Amount *</label>
            <input type="number" class="form-input" id="pay-amount" min="0" step="0.01">
          </div>
          <div class="form-group">
            <label class="form-label">Date *</label>
            <input type="date" class="form-input" id="pay-date">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Type</label>
            <select class="form-input" id="pay-type">
              <option value="dues">Dues</option>
              <option value="renewal">Renewal</option>
              <option value="initiation">Initiation Fee</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Method</label>
            <select class="form-input" id="pay-method">
              <option value="credit-card">Credit Card</option>
              <option value="check">Check</option>
              <option value="cash">Cash</option>
              <option value="bank-transfer">Bank Transfer</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Notes</label>
          <textarea class="form-input" id="pay-notes" rows="2"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('payment-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="savePayment()">Save</button>
      </div>
    </div>
  </div>
  
  <!-- Tier Modal -->
  <div class="modal-overlay" id="tier-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="tier-modal-title">Add Tier</h3>
        <button class="modal-close" onclick="closeModal('tier-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="tier-id">
        <div class="form-group">
          <label class="form-label">Tier Name *</label>
          <input type="text" class="form-input" id="tier-name" placeholder="e.g., Gold, Premium">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Annual Dues *</label>
            <input type="number" class="form-input" id="tier-price" min="0" step="0.01">
          </div>
          <div class="form-group">
            <label class="form-label">Initiation Fee</label>
            <input type="number" class="form-input" id="tier-initiation" min="0" step="0.01" value="0">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Duration (months)</label>
          <select class="form-input" id="tier-duration">
            <option value="12">12 months (Annual)</option>
            <option value="6">6 months (Semi-Annual)</option>
            <option value="3">3 months (Quarterly)</option>
            <option value="1">1 month (Monthly)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Benefits / Description</label>
          <textarea class="form-input" id="tier-benefits" rows="3" placeholder="List benefits..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Color</label>
          <select class="form-input" id="tier-color">
            <option value="standard">Purple (Standard)</option>
            <option value="gold">Gold</option>
            <option value="silver">Silver</option>
            <option value="bronze">Bronze</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" id="tier-delete-btn" onclick="deleteTier()" style="margin-right:auto;display:none;">Delete</button>
        <button class="btn btn-secondary" onclick="closeModal('tier-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveTier()">Save</button>
      </div>
    </div>
  </div>
  
  <!-- Renew Modal -->
  <div class="modal-overlay" id="renew-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Renew Membership</h3>
        <button class="modal-close" onclick="closeModal('renew-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="renew-member-id">
        <p id="renew-info" style="margin-bottom: 1rem;"></p>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">New Expiration</label>
            <input type="date" class="form-input" id="renew-date">
          </div>
          <div class="form-group">
            <label class="form-label">Payment Amount</label>
            <input type="number" class="form-input" id="renew-amount" min="0" step="0.01">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Payment Method</label>
          <select class="form-input" id="renew-method">
            <option value="credit-card">Credit Card</option>
            <option value="check">Check</option>
            <option value="cash">Cash</option>
            <option value="bank-transfer">Bank Transfer</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('renew-modal')">Cancel</button>
        <button class="btn btn-success" onclick="processRenewal()">Process Renewal</button>
      </div>
    </div>
  </div>
  
  <div class="toast-container" id="toast-container"></div>

  <script>
    let members = [], tiers = [], payments = [];
    
    function init() {
      loadData();
      setupTabs();
      renderAll();
    }
    
    function loadData() {
      const saved = {
        members: localStorage.getItem('memberhub_members'),
        tiers: localStorage.getItem('memberhub_tiers'),
        payments: localStorage.getItem('memberhub_payments')
      };
      
      tiers = saved.tiers ? JSON.parse(saved.tiers) : [
        { id: 1, name: 'Gold', price: 500, initiation: 100, duration: 12, benefits: 'Full access to all facilities\nGuest passes (4/year)\nPriority booking\nMember events', color: 'gold' },
        { id: 2, name: 'Silver', price: 300, initiation: 50, duration: 12, benefits: 'Access to main facilities\nGuest passes (2/year)\nMember events', color: 'silver' },
        { id: 3, name: 'Bronze', price: 150, initiation: 0, duration: 12, benefits: 'Limited facility access\nMember events', color: 'bronze' },
        { id: 4, name: 'Student', price: 75, initiation: 0, duration: 12, benefits: 'Student rate (ID required)\nLimited hours access', color: 'standard' },
      ];
      
      const today = new Date();
      const oneYearAgo = new Date(today.getFullYear() - 1, today.getMonth(), today.getDate()).toISOString().split('T')[0];
      const sixMonthsAgo = new Date(today.getFullYear(), today.getMonth() - 6, today.getDate()).toISOString().split('T')[0];
      const threeMonthsAgo = new Date(today.getFullYear(), today.getMonth() - 3, today.getDate()).toISOString().split('T')[0];
      const oneMonthAgo = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate()).toISOString().split('T')[0];
      const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, today.getDate()).toISOString().split('T')[0];
      const nextWeek = new Date(today.getTime() + 7 * 86400000).toISOString().split('T')[0];
      const inTwoWeeks = new Date(today.getTime() + 14 * 86400000).toISOString().split('T')[0];
      const nextYear = new Date(today.getFullYear() + 1, today.getMonth(), today.getDate()).toISOString().split('T')[0];
      const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 15).toISOString().split('T')[0];
      
      members = saved.members ? JSON.parse(saved.members) : [
        { id: 1, first: 'John', last: 'Anderson', email: 'john.anderson@email.com', phone: '555-0101', address: '123 Main St', tierId: 1, status: 'active', joinDate: oneYearAgo, expiration: nextYear, notes: 'Charter member' },
        { id: 2, first: 'Sarah', last: 'Johnson', email: 'sarah.j@email.com', phone: '555-0102', address: '456 Oak Ave', tierId: 1, status: 'active', joinDate: sixMonthsAgo, expiration: nextMonth, notes: '' },
        { id: 3, first: 'Michael', last: 'Williams', email: 'mwilliams@email.com', phone: '555-0103', address: '789 Pine Rd', tierId: 2, status: 'active', joinDate: threeMonthsAgo, expiration: nextWeek, notes: 'Referred by John Anderson' },
        { id: 4, first: 'Emily', last: 'Brown', email: 'emily.b@email.com', phone: '555-0104', address: '321 Elm St', tierId: 2, status: 'active', joinDate: oneMonthAgo, expiration: inTwoWeeks, notes: '' },
        { id: 5, first: 'David', last: 'Miller', email: 'david.m@email.com', phone: '555-0105', address: '654 Cedar Ln', tierId: 3, status: 'expired', joinDate: oneYearAgo, expiration: lastMonth, notes: 'Needs follow-up' },
        { id: 6, first: 'Lisa', last: 'Davis', email: 'lisa.d@email.com', phone: '555-0106', address: '987 Birch Blvd', tierId: 4, status: 'active', joinDate: threeMonthsAgo, expiration: nextYear, notes: 'College student' },
        { id: 7, first: 'Robert', last: 'Wilson', email: 'rwilson@email.com', phone: '555-0107', address: '147 Maple Dr', tierId: 1, status: 'pending', joinDate: today.toISOString().split('T')[0], expiration: nextYear, notes: 'Awaiting payment' },
      ];
      
      payments = saved.payments ? JSON.parse(saved.payments) : [
        { id: 1, memberId: 1, amount: 600, date: oneYearAgo, type: 'initiation', method: 'credit-card', notes: 'Gold membership + initiation' },
        { id: 2, memberId: 2, amount: 600, date: sixMonthsAgo, type: 'initiation', method: 'check', notes: 'Gold membership + initiation' },
        { id: 3, memberId: 3, amount: 350, date: threeMonthsAgo, type: 'initiation', method: 'credit-card', notes: 'Silver membership + initiation' },
        { id: 4, memberId: 4, amount: 350, date: oneMonthAgo, type: 'initiation', method: 'credit-card', notes: 'Silver membership + initiation' },
        { id: 5, memberId: 5, amount: 150, date: oneYearAgo, type: 'dues', method: 'cash', notes: 'Bronze annual dues' },
        { id: 6, memberId: 6, amount: 75, date: threeMonthsAgo, type: 'dues', method: 'credit-card', notes: 'Student membership' },
      ];
      
      saveData();
    }
    
    function saveData() {
      localStorage.setItem('memberhub_members', JSON.stringify(members));
      localStorage.setItem('memberhub_tiers', JSON.stringify(tiers));
      localStorage.setItem('memberhub_payments', JSON.stringify(payments));
    }
    
    function setupTabs() {
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          tab.classList.add('active');
          document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
        });
      });
    }
    
    function renderAll() {
      renderDashboard();
      renderMembers();
      renderPayments();
      renderTiers();
      renderReports();
      updateSelects();
    }
    
    function updateSelects() {
      const tierOpts = '<option value="">Select Tier</option>' + tiers.map(t => `<option value="${t.id}">${t.name} ($${t.price}/yr)</option>`).join('');
      document.getElementById('mem-tier').innerHTML = tierOpts;
      document.getElementById('filter-tier').innerHTML = '<option value="">All Tiers</option>' + tiers.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
      
      const memberOpts = '<option value="">Select Member</option>' + members.map(m => `<option value="${m.id}">${m.first} ${m.last}</option>`).join('');
      document.getElementById('pay-member').innerHTML = memberOpts;
    }
    
    function getMemberStatus(member) {
      if (member.status === 'cancelled') return 'cancelled';
      if (member.status === 'pending') return 'pending';
      
      const today = new Date();
      const exp = new Date(member.expiration + 'T23:59:59');
      const daysUntil = Math.ceil((exp - today) / 86400000);
      
      if (daysUntil < 0) return 'expired';
      if (daysUntil <= 30) return 'grace';
      return 'active';
    }
    
    // Dashboard
    function renderDashboard() {
      const today = new Date();
      const thirtyDays = new Date(today.getTime() + 30 * 86400000);
      const thisYear = today.getFullYear();
      
      const active = members.filter(m => getMemberStatus(m) === 'active' || getMemberStatus(m) === 'grace').length;
      const expiring = members.filter(m => {
        const exp = new Date(m.expiration);
        return exp >= today && exp <= thirtyDays && m.status !== 'cancelled';
      }).length;
      const expired = members.filter(m => getMemberStatus(m) === 'expired').length;
      
      const ytdRevenue = payments.filter(p => new Date(p.date).getFullYear() === thisYear).reduce((sum, p) => sum + p.amount, 0);
      
      document.getElementById('stat-total').textContent = members.length;
      document.getElementById('stat-active').textContent = active;
      document.getElementById('stat-expiring').textContent = expiring;
      document.getElementById('stat-expired').textContent = expired;
      document.getElementById('stat-revenue').textContent = formatCurrency(ytdRevenue);
      
      // Upcoming renewals
      const upcoming = members.filter(m => {
        const exp = new Date(m.expiration);
        return exp >= today && exp <= thirtyDays && m.status !== 'cancelled';
      }).sort((a, b) => new Date(a.expiration) - new Date(b.expiration)).slice(0, 5);
      
      document.getElementById('upcoming-renewals').innerHTML = upcoming.length ? upcoming.map(m => {
        const tier = tiers.find(t => t.id === m.tierId);
        const daysLeft = Math.ceil((new Date(m.expiration) - today) / 86400000);
        return `<div class="renewal-item">
          <div>
            <div style="font-weight: 500;">${m.first} ${m.last}</div>
            <div style="font-size: 0.875rem; color: var(--gray-500);">Expires ${formatDate(m.expiration)} (${daysLeft} days)</div>
          </div>
          <button class="btn btn-sm btn-success" onclick="openRenewModal(${m.id})">Renew</button>
        </div>`;
      }).join('') : '<div class="empty-state">No upcoming renewals</div>';
      
      // Recent members
      const recent = [...members].sort((a, b) => new Date(b.joinDate) - new Date(a.joinDate)).slice(0, 5);
      document.getElementById('recent-members').innerHTML = recent.map(m => {
        const tier = tiers.find(t => t.id === m.tierId);
        return `<div class="renewal-item">
          <div class="member-row">
            <div class="member-avatar">${m.first[0]}${m.last[0]}</div>
            <div>
              <div style="font-weight: 500;">${m.first} ${m.last}</div>
              <div style="font-size: 0.875rem; color: var(--gray-500);">Joined ${formatDate(m.joinDate)}</div>
            </div>
          </div>
          <span class="tier-badge ${tier?.color || 'standard'}">${tier?.name || 'Unknown'}</span>
        </div>`;
      }).join('');
      
      // Tier breakdown
      const tierCounts = {};
      tiers.forEach(t => tierCounts[t.id] = 0);
      members.filter(m => getMemberStatus(m) !== 'cancelled').forEach(m => {
        tierCounts[m.tierId] = (tierCounts[m.tierId] || 0) + 1;
      });
      
      const maxCount = Math.max(...Object.values(tierCounts), 1);
      
      document.getElementById('tier-breakdown').innerHTML = tiers.map(t => `
        <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
          <span style="width: 100px; font-weight: 500;">${t.name}</span>
          <div style="flex: 1; height: 24px; background: var(--gray-200); border-radius: 4px; margin: 0 1rem;">
            <div style="width: ${(tierCounts[t.id] || 0) / maxCount * 100}%; height: 100%; background: var(--primary); border-radius: 4px;"></div>
          </div>
          <span style="width: 40px; text-align: right; font-weight: 600;">${tierCounts[t.id] || 0}</span>
        </div>
      `).join('');
    }
    
    // Members
    function renderMembers() {
      const statusFilter = document.getElementById('filter-status').value;
      const tierFilter = document.getElementById('filter-tier').value;
      const search = document.getElementById('filter-search').value.toLowerCase();
      
      let filtered = [...members];
      if (statusFilter) {
        filtered = filtered.filter(m => {
          const status = getMemberStatus(m);
          if (statusFilter === 'active') return status === 'active' || status === 'grace';
          return status === statusFilter;
        });
      }
      if (tierFilter) filtered = filtered.filter(m => m.tierId === parseInt(tierFilter));
      if (search) filtered = filtered.filter(m => 
        m.first.toLowerCase().includes(search) || 
        m.last.toLowerCase().includes(search) ||
        m.email.toLowerCase().includes(search)
      );
      
      filtered.sort((a, b) => a.last.localeCompare(b.last));
      
      document.getElementById('members-table').innerHTML = filtered.map(m => {
        const tier = tiers.find(t => t.id === m.tierId);
        const status = getMemberStatus(m);
        const balance = getBalance(m.id);
        
        return `<tr>
          <td>
            <div class="member-row">
              <div class="member-avatar">${m.first[0]}${m.last[0]}</div>
              <div class="member-info">
                <div class="member-name">${m.first} ${m.last}</div>
                <div class="member-email">${m.email}</div>
              </div>
            </div>
          </td>
          <td><span class="tier-badge ${tier?.color || 'standard'}">${tier?.name || 'Unknown'}</span></td>
          <td>${formatDate(m.joinDate)}</td>
          <td>${formatDate(m.expiration)}</td>
          <td><span class="status-badge ${status}">${status}</span></td>
          <td style="color: ${balance > 0 ? 'var(--danger)' : 'var(--success)'}">${balance > 0 ? formatCurrency(balance) + ' due' : 'Paid'}</td>
          <td>
            <button class="btn btn-sm btn-secondary" onclick="editMember(${m.id})">Edit</button>
            ${status !== 'cancelled' ? `<button class="btn btn-sm btn-success" onclick="openRenewModal(${m.id})">Renew</button>` : ''}
          </td>
        </tr>`;
      }).join('');
    }
    
    function getBalance(memberId) {
      const member = members.find(m => m.id === memberId);
      if (!member) return 0;
      const tier = tiers.find(t => t.id === member.tierId);
      if (!tier) return 0;
      
      const paid = payments.filter(p => p.memberId === memberId).reduce((sum, p) => sum + p.amount, 0);
      const owed = tier.price + tier.initiation;
      return Math.max(0, owed - paid);
    }
    
    function openMemberModal(id = null) {
      const today = new Date().toISOString().split('T')[0];
      const nextYear = new Date(new Date().getFullYear() + 1, new Date().getMonth(), new Date().getDate()).toISOString().split('T')[0];
      
      if (id) {
        const m = members.find(x => x.id === id);
        document.getElementById('member-modal-title').textContent = 'Edit Member';
        document.getElementById('mem-id').value = id;
        document.getElementById('mem-first').value = m.first;
        document.getElementById('mem-last').value = m.last;
        document.getElementById('mem-email').value = m.email;
        document.getElementById('mem-phone').value = m.phone || '';
        document.getElementById('mem-address').value = m.address || '';
        document.getElementById('mem-tier').value = m.tierId;
        document.getElementById('mem-status').value = m.status;
        document.getElementById('mem-join').value = m.joinDate;
        document.getElementById('mem-expiration').value = m.expiration;
        document.getElementById('mem-notes').value = m.notes || '';
        document.getElementById('mem-delete-btn').style.display = 'block';
      } else {
        document.getElementById('member-modal-title').textContent = 'Add Member';
        document.getElementById('mem-id').value = '';
        document.getElementById('mem-first').value = '';
        document.getElementById('mem-last').value = '';
        document.getElementById('mem-email').value = '';
        document.getElementById('mem-phone').value = '';
        document.getElementById('mem-address').value = '';
        document.getElementById('mem-tier').value = '';
        document.getElementById('mem-status').value = 'pending';
        document.getElementById('mem-join').value = today;
        document.getElementById('mem-expiration').value = nextYear;
        document.getElementById('mem-notes').value = '';
        document.getElementById('mem-delete-btn').style.display = 'none';
      }
      document.getElementById('member-modal').classList.add('active');
    }
    
    function editMember(id) { openMemberModal(id); }
    
    function saveMember() {
      const id = document.getElementById('mem-id').value;
      const first = document.getElementById('mem-first').value.trim();
      const last = document.getElementById('mem-last').value.trim();
      const email = document.getElementById('mem-email').value.trim();
      const phone = document.getElementById('mem-phone').value.trim();
      const address = document.getElementById('mem-address').value.trim();
      const tierId = parseInt(document.getElementById('mem-tier').value);
      const status = document.getElementById('mem-status').value;
      const joinDate = document.getElementById('mem-join').value;
      const expiration = document.getElementById('mem-expiration').value;
      const notes = document.getElementById('mem-notes').value.trim();
      
      if (!first || !last || !email || !tierId) { showToast('Please fill required fields', 'error'); return; }
      
      if (id) {
        const i = members.findIndex(m => m.id === parseInt(id));
        members[i] = { ...members[i], first, last, email, phone, address, tierId, status, joinDate, expiration, notes };
        showToast('Member updated');
      } else {
        members.push({ id: Math.max(0, ...members.map(m => m.id)) + 1, first, last, email, phone, address, tierId, status, joinDate, expiration, notes });
        showToast('Member added');
      }
      
      saveData();
      renderAll();
      closeModal('member-modal');
    }
    
    function deleteMember() {
      const id = parseInt(document.getElementById('mem-id').value);
      if (!confirm('Delete this member?')) return;
      members = members.filter(m => m.id !== id);
      saveData();
      renderAll();
      closeModal('member-modal');
      showToast('Member deleted');
    }
    
    function openRenewModal(memberId) {
      const member = members.find(m => m.id === memberId);
      const tier = tiers.find(t => t.id === member.tierId);
      
      const currentExp = new Date(member.expiration);
      const newExp = new Date(currentExp);
      newExp.setMonth(newExp.getMonth() + (tier?.duration || 12));
      
      document.getElementById('renew-member-id').value = memberId;
      document.getElementById('renew-info').innerHTML = `
        Renewing <strong>${member.first} ${member.last}</strong> (${tier?.name || 'Unknown'} - ${formatCurrency(tier?.price || 0)}/yr)
        <br>Current expiration: ${formatDate(member.expiration)}
      `;
      document.getElementById('renew-date').value = newExp.toISOString().split('T')[0];
      document.getElementById('renew-amount').value = tier?.price || 0;
      
      document.getElementById('renew-modal').classList.add('active');
    }
    
    function processRenewal() {
      const memberId = parseInt(document.getElementById('renew-member-id').value);
      const newExpiration = document.getElementById('renew-date').value;
      const amount = parseFloat(document.getElementById('renew-amount').value) || 0;
      const method = document.getElementById('renew-method').value;
      
      const member = members.find(m => m.id === memberId);
      member.expiration = newExpiration;
      member.status = 'active';
      
      if (amount > 0) {
        payments.push({
          id: Math.max(0, ...payments.map(p => p.id)) + 1,
          memberId,
          amount,
          date: new Date().toISOString().split('T')[0],
          type: 'renewal',
          method,
          notes: 'Membership renewal'
        });
      }
      
      saveData();
      renderAll();
      closeModal('renew-modal');
      showToast('Membership renewed');
    }
    
    // Payments
    function renderPayments() {
      const typeFilter = document.getElementById('filter-payment-type').value;
      const monthFilter = document.getElementById('filter-payment-month').value;
      
      let filtered = [...payments].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      if (typeFilter) filtered = filtered.filter(p => p.type === typeFilter);
      if (monthFilter) filtered = filtered.filter(p => p.date.startsWith(monthFilter));
      
      document.getElementById('payments-table').innerHTML = filtered.map(p => {
        const member = members.find(m => m.id === p.memberId);
        return `<tr>
          <td>${formatDate(p.date)}</td>
          <td>${member ? member.first + ' ' + member.last : 'Unknown'}</td>
          <td style="text-transform: capitalize;">${p.type}</td>
          <td><strong>${formatCurrency(p.amount)}</strong></td>
          <td style="text-transform: capitalize;">${p.method.replace('-', ' ')}</td>
          <td>${p.notes || '-'}</td>
        </tr>`;
      }).join('');
    }
    
    function openPaymentModal() {
      document.getElementById('pay-member').value = '';
      document.getElementById('pay-amount').value = '';
      document.getElementById('pay-date').value = new Date().toISOString().split('T')[0];
      document.getElementById('pay-type').value = 'dues';
      document.getElementById('pay-method').value = 'credit-card';
      document.getElementById('pay-notes').value = '';
      document.getElementById('payment-modal').classList.add('active');
    }
    
    function savePayment() {
      const memberId = parseInt(document.getElementById('pay-member').value);
      const amount = parseFloat(document.getElementById('pay-amount').value);
      const date = document.getElementById('pay-date').value;
      const type = document.getElementById('pay-type').value;
      const method = document.getElementById('pay-method').value;
      const notes = document.getElementById('pay-notes').value.trim();
      
      if (!memberId || !amount || !date) { showToast('Please fill required fields', 'error'); return; }
      
      payments.push({ id: Math.max(0, ...payments.map(p => p.id)) + 1, memberId, amount, date, type, method, notes });
      
      // Auto-activate if pending
      const member = members.find(m => m.id === memberId);
      if (member && member.status === 'pending') {
        member.status = 'active';
      }
      
      saveData();
      renderAll();
      closeModal('payment-modal');
      showToast('Payment recorded');
    }
    
    // Tiers
    function renderTiers() {
      document.getElementById('tiers-grid').innerHTML = tiers.map(t => {
        const memberCount = members.filter(m => m.tierId === t.id && getMemberStatus(m) !== 'cancelled').length;
        return `<div class="tier-card">
          <span class="tier-badge ${t.color}" style="margin-bottom: 0.5rem;">${t.name}</span>
          <div class="tier-price">${formatCurrency(t.price)}</div>
          <div class="tier-period">per ${t.duration === 12 ? 'year' : t.duration + ' months'}</div>
          ${t.initiation > 0 ? `<div style="font-size: 0.875rem; color: var(--gray-500); margin-top: 0.25rem;">+ ${formatCurrency(t.initiation)} initiation</div>` : ''}
          <div class="tier-features">${t.benefits ? t.benefits.split('\n').slice(0, 3).join('<br>') : 'No benefits listed'}</div>
          <div style="margin-top: 1rem; padding-top: 0.75rem; border-top: 1px solid var(--gray-200);">
            <strong>${memberCount}</strong> members
          </div>
          <button class="btn btn-sm btn-secondary" style="margin-top: 0.75rem;" onclick="editTier(${t.id})">Edit</button>
        </div>`;
      }).join('');
    }
    
    function openTierModal(id = null) {
      if (id) {
        const t = tiers.find(x => x.id === id);
        document.getElementById('tier-modal-title').textContent = 'Edit Tier';
        document.getElementById('tier-id').value = id;
        document.getElementById('tier-name').value = t.name;
        document.getElementById('tier-price').value = t.price;
        document.getElementById('tier-initiation').value = t.initiation || 0;
        document.getElementById('tier-duration').value = t.duration;
        document.getElementById('tier-benefits').value = t.benefits || '';
        document.getElementById('tier-color').value = t.color || 'standard';
        document.getElementById('tier-delete-btn').style.display = 'block';
      } else {
        document.getElementById('tier-modal-title').textContent = 'Add Tier';
        document.getElementById('tier-id').value = '';
        document.getElementById('tier-name').value = '';
        document.getElementById('tier-price').value = '';
        document.getElementById('tier-initiation').value = 0;
        document.getElementById('tier-duration').value = '12';
        document.getElementById('tier-benefits').value = '';
        document.getElementById('tier-color').value = 'standard';
        document.getElementById('tier-delete-btn').style.display = 'none';
      }
      document.getElementById('tier-modal').classList.add('active');
    }
    
    function editTier(id) { openTierModal(id); }
    
    function saveTier() {
      const id = document.getElementById('tier-id').value;
      const name = document.getElementById('tier-name').value.trim();
      const price = parseFloat(document.getElementById('tier-price').value) || 0;
      const initiation = parseFloat(document.getElementById('tier-initiation').value) || 0;
      const duration = parseInt(document.getElementById('tier-duration').value);
      const benefits = document.getElementById('tier-benefits').value.trim();
      const color = document.getElementById('tier-color').value;
      
      if (!name || !price) { showToast('Please enter name and price', 'error'); return; }
      
      if (id) {
        const i = tiers.findIndex(t => t.id === parseInt(id));
        tiers[i] = { ...tiers[i], name, price, initiation, duration, benefits, color };
        showToast('Tier updated');
      } else {
        tiers.push({ id: Math.max(0, ...tiers.map(t => t.id)) + 1, name, price, initiation, duration, benefits, color });
        showToast('Tier added');
      }
      
      saveData();
      renderAll();
      closeModal('tier-modal');
    }
    
    function deleteTier() {
      const id = parseInt(document.getElementById('tier-id').value);
      const hasMembers = members.some(m => m.tierId === id);
      if (hasMembers) { showToast('Cannot delete tier with members', 'error'); return; }
      if (!confirm('Delete this tier?')) return;
      tiers = tiers.filter(t => t.id !== id);
      saveData();
      renderAll();
      closeModal('tier-modal');
      showToast('Tier deleted');
    }
    
    // Reports
    function renderReports() {
      const thisYear = new Date().getFullYear();
      
      // Monthly revenue
      const monthlyData = Array(12).fill(0);
      payments.filter(p => new Date(p.date).getFullYear() === thisYear).forEach(p => {
        monthlyData[new Date(p.date).getMonth()] += p.amount;
      });
      
      const maxMonth = Math.max(...monthlyData, 1);
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      
      document.getElementById('revenue-chart').innerHTML = monthlyData.map((val, i) => `
        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
          <div style="width: 100%; max-width: 40px; background: var(--primary-light); border-radius: 4px 4px 0 0; height: ${val / maxMonth * 150}px; min-height: 4px;"></div>
          <div style="font-size: 0.7rem; color: var(--gray-500); margin-top: 0.25rem;">${months[i]}</div>
          <div style="font-size: 0.65rem; color: var(--gray-400);">${val > 0 ? '$' + Math.round(val) : ''}</div>
        </div>
      `).join('');
      
      // Statistics
      const activeMembers = members.filter(m => getMemberStatus(m) === 'active' || getMemberStatus(m) === 'grace');
      const lastYearMembers = members.filter(m => new Date(m.joinDate) <= new Date(thisYear - 1, 11, 31));
      const retained = lastYearMembers.filter(m => getMemberStatus(m) !== 'expired' && getMemberStatus(m) !== 'cancelled').length;
      const retentionRate = lastYearMembers.length > 0 ? Math.round(retained / lastYearMembers.length * 100) : 0;
      
      const avgTenure = activeMembers.length > 0 ? 
        Math.round(activeMembers.reduce((sum, m) => {
          const months = Math.floor((new Date() - new Date(m.joinDate)) / (30 * 86400000));
          return sum + months;
        }, 0) / activeMembers.length) : 0;
      
      const newYTD = members.filter(m => new Date(m.joinDate).getFullYear() === thisYear).length;
      
      document.getElementById('stat-retention').textContent = retentionRate + '%';
      document.getElementById('stat-avg-tenure').textContent = avgTenure;
      document.getElementById('stat-new-ytd').textContent = newYTD;
    }
    
    // Exports
    function exportMembers() {
      const headers = ['First', 'Last', 'Email', 'Phone', 'Address', 'Tier', 'Status', 'Join Date', 'Expiration'];
      const rows = members.map(m => {
        const tier = tiers.find(t => t.id === m.tierId);
        return [m.first, m.last, m.email, m.phone, m.address, tier?.name || '', getMemberStatus(m), m.joinDate, m.expiration];
      });
      downloadCSV([headers, ...rows], 'members.csv');
      showToast('Members exported');
    }
    
    function exportActive() {
      const active = members.filter(m => getMemberStatus(m) === 'active' || getMemberStatus(m) === 'grace');
      const headers = ['First', 'Last', 'Email', 'Phone', 'Tier', 'Expiration'];
      const rows = active.map(m => {
        const tier = tiers.find(t => t.id === m.tierId);
        return [m.first, m.last, m.email, m.phone, tier?.name || '', m.expiration];
      });
      downloadCSV([headers, ...rows], 'active-members.csv');
      showToast('Active members exported');
    }
    
    function exportExpiring() {
      const today = new Date();
      const thirtyDays = new Date(today.getTime() + 30 * 86400000);
      const expiring = members.filter(m => {
        const exp = new Date(m.expiration);
        return exp >= today && exp <= thirtyDays && m.status !== 'cancelled';
      });
      const headers = ['First', 'Last', 'Email', 'Phone', 'Tier', 'Expiration', 'Days Left'];
      const rows = expiring.map(m => {
        const tier = tiers.find(t => t.id === m.tierId);
        const daysLeft = Math.ceil((new Date(m.expiration) - today) / 86400000);
        return [m.first, m.last, m.email, m.phone, tier?.name || '', m.expiration, daysLeft];
      });
      downloadCSV([headers, ...rows], 'expiring-members.csv');
      showToast('Expiring members exported');
    }
    
    function exportPayments() {
      const headers = ['Date', 'Member', 'Type', 'Amount', 'Method', 'Notes'];
      const rows = payments.map(p => {
        const member = members.find(m => m.id === p.memberId);
        return [p.date, member ? member.first + ' ' + member.last : '', p.type, p.amount, p.method, p.notes];
      });
      downloadCSV([headers, ...rows], 'payments.csv');
      showToast('Payments exported');
    }
    
    function exportRevenue() {
      const thisYear = new Date().getFullYear();
      const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      const monthlyData = Array(12).fill(0);
      payments.filter(p => new Date(p.date).getFullYear() === thisYear).forEach(p => {
        monthlyData[new Date(p.date).getMonth()] += p.amount;
      });
      
      const headers = ['Month', 'Revenue'];
      const rows = months.map((m, i) => [m, monthlyData[i]]);
      rows.push(['Total', monthlyData.reduce((a, b) => a + b, 0)]);
      downloadCSV([headers, ...rows], `revenue-${thisYear}.csv`);
      showToast('Revenue report exported');
    }
    
    function downloadCSV(data, filename) {
      const csv = data.map(r => r.map(c => `"${c}"`).join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filename; a.click();
    }
    
    // Helpers
    function formatCurrency(n) { return '$' + (n || 0).toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 }); }
    function formatDate(d) { return d ? new Date(d + 'T00:00:00').toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : ''; }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }
    
    function showToast(msg, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = msg;
      document.getElementById('toast-container').appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }
    
    document.querySelectorAll('.modal-overlay').forEach(o => o.addEventListener('click', e => { if (e.target === o) o.classList.remove('active'); }));
    
    init();
  </script>
</body>
</html>
