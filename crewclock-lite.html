<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="manifest" href="data:application/json,%7B%22name%22%3A%22CrewClock%22%2C%22short_name%22%3A%22CrewClock%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23f8fafc%22%2C%22theme_color%22%3A%22%233b82f6%22%7D" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CrewClock - Simple Time Clock</title>
  
  <!-- PWA Support -->
  <meta name="theme-color" content="#0891b2" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="CrewClock" />
  
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f1f5f9;
      --bg-card: #ffffff;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #94a3b8;
      --border: #e2e8f0;
      --accent: #0891b2;
      --accent-hover: #0e7490;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;
    }
    .dark {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --bg-card: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --text-muted: #64748b;
      --border: #334155;
    }
    body { font-family: 'DM Sans', -apple-system, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
    #root { min-height: 100vh; }

    /* Print Styles */
    @media print {
      body { background: white !important; color: black !important; font-size: 12pt; }
      header, nav, footer, button, .no-print { display: none !important; }
      [style*="position: fixed"] { display: none !important; }
      main { padding: 0 !important; max-width: 100% !important; }
      * { box-shadow: none !important; text-shadow: none !important; }
      a { text-decoration: none; color: black !important; }
      table { border-collapse: collapse; width: 100%; page-break-inside: auto; }
      tr { page-break-inside: avoid; page-break-after: auto; }
      th, td { border: 1px solid #ccc !important; padding: 8px !important; text-align: left; }
      th { background: #f0f0f0 !important; font-weight: bold; }
      h1, h2, h3 { color: black !important; page-break-after: avoid; }
      .card, [class*="card"], [class*="Card"] { border: 1px solid #ccc !important; background: white !important; }
      @page { margin: 1.5cm; }
    }

    /* Accessibility */
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
    .skip-link { position: absolute; top: -40px; left: 0; background: var(--accent); color: white; padding: 8px 16px; z-index: 10000; border-radius: 0 0 8px 0; transition: top 0.2s; }
    .skip-link:focus { top: 0; }
    *:focus { outline: 2px solid var(--accent); outline-offset: 2px; }
    *:focus:not(:focus-visible) { outline: none; }
    *:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <div id="root"></div>
    <script>
    // Pre-load Recharts fallback
    if (typeof window.Recharts === "undefined") {
      window.Recharts = {
        ResponsiveContainer: function() { return null; },
        BarChart: function() { return null; }, LineChart: function() { return null; },
        PieChart: function() { return null; }, AreaChart: function() { return null; },
        CartesianGrid: function() { return null; }, XAxis: function() { return null; },
        YAxis: function() { return null; }, Tooltip: function() { return null; },
        Bar: function() { return null; }, Line: function() { return null; },
        Pie: function() { return null; }, Area: function() { return null; },
        Cell: function() { return null; }, Legend: function() { return null; }
      };
    }
  </script>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Utilities
    const generateId = () => Math.random().toString(36).substr(2, 9);
    const save = (key, data) => localStorage.setItem(key, JSON.stringify(data));
    const load = (key, fallback) => { try { return JSON.parse(localStorage.getItem(key)) || fallback; } catch { return fallback; } };
    
    const formatDate = (date) => new Date(date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
    const formatTime = (date) => new Date(date).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
    const formatDuration = (minutes) => {
      if (!minutes || minutes < 0) return '0:00';
      const h = Math.floor(minutes / 60);
      const m = Math.round(minutes % 60);
      return `${h}:${m.toString().padStart(2, '0')}`;
    };
    const getMinutesBetween = (start, end) => {
      if (!start || !end) return 0;
      return Math.round((new Date(end) - new Date(start)) / 60000);
    };

    // Default data
    const DEFAULT_EMPLOYEES = [
      { id: 'emp1', name: 'John Smith', pin: '1234', role: 'Staff', hourlyRate: 15, active: true },
      { id: 'emp2', name: 'Jane Doe', pin: '5678', role: 'Manager', hourlyRate: 22, active: true },
    ];

    const DEFAULT_JOBS = [
      { id: 'job1', name: 'General', code: 'GEN', active: true },
      { id: 'job2', name: 'Maintenance', code: 'MAINT', active: true },
      { id: 'job3', name: 'Events', code: 'EVENT', active: true },
    ];


    // Icons
    const Icons = {
      Clock: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Users: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      List: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>,
      Settings: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
      Plus: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
      Check: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      Edit: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
      Trash: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
      Download: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
      Upload: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
      Play: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
      Square: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>,
      BarChart: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>,
      Calendar: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
      Briefcase: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>,
      FileText: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>,
      RotateCcw: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>,
      RotateCw: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>,
    };

    // Components
    const Button = ({ children, variant = 'primary', size = 'md', onClick, disabled, style, title, ariaLabel }) => {
      const base = { display: 'inline-flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem', fontFamily: 'inherit', fontWeight: 600, border: 'none', borderRadius: '10px', cursor: disabled ? 'not-allowed' : 'pointer', transition: 'all 0.15s ease', opacity: disabled ? 0.5 : 1 };
      const variants = {
        primary: { background: 'var(--accent)', color: 'white' },
        secondary: { background: 'var(--bg-tertiary)', color: 'var(--text-primary)', border: '1px solid var(--border)' },
        danger: { background: 'var(--danger)', color: 'white' },
        ghost: { background: 'transparent', color: 'var(--text-secondary)' },
        success: { background: 'var(--success)', color: 'white' },
      };
      const sizes = { sm: { padding: '0.5rem 0.875rem', fontSize: '0.8125rem' }, md: { padding: '0.75rem 1.25rem', fontSize: '0.9375rem' }, lg: { padding: '1rem 2rem', fontSize: '1.125rem' } };
      return <button style={{ ...base, ...variants[variant], ...sizes[size], ...style }} onClick={onClick} disabled={disabled} title={title} aria-label={ariaLabel || title} aria-disabled={disabled}>{children}</button>;
    };

    const Input = ({ label, value, onChange, type = 'text', placeholder, style, required, disabled, id }) => {
      const inputId = id || React.useId();
      return (
        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.375rem', ...style }}>
          {label && <label htmlFor={inputId} style={{ fontSize: '0.8125rem', color: 'var(--text-secondary)', fontWeight: 500 }}>{label} {required && <span style={{ color: 'var(--danger)' }} aria-hidden="true">*</span>}{required && <span className="sr-only">(required)</span>}</label>}
          <input id={inputId} type={type} value={value} onChange={(e) => onChange(e.target.value)} placeholder={placeholder} disabled={disabled} aria-required={required} aria-disabled={disabled}
            style={{ background: 'var(--bg-tertiary)', border: '1px solid var(--border)', borderRadius: '8px', padding: '0.75rem', color: 'var(--text-primary)', outline: 'none', fontFamily: 'inherit', fontSize: '0.9375rem' }} />
        </div>
      );
    };

    const Select = ({ label, value, onChange, options, style, id }) => {
      const selectId = id || React.useId();
      return (
        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.375rem', ...style }}>
          {label && <label htmlFor={selectId} style={{ fontSize: '0.8125rem', color: 'var(--text-secondary)', fontWeight: 500 }}>{label}</label>}
          <select id={selectId} value={value} onChange={(e) => onChange(e.target.value)}
            style={{ background: 'var(--bg-tertiary)', border: '1px solid var(--border)', borderRadius: '8px', padding: '0.75rem', color: 'var(--text-primary)', fontFamily: 'inherit', fontSize: '0.9375rem', cursor: 'pointer' }}>
            {options.map(opt => <option key={opt.value} value={opt.value}>{opt.label}</option>)}
          </select>
        </div>
      );
    };

    const Modal = ({ isOpen, onClose, title, children, width = '480px' }) => {
      const modalRef = useRef(null);
      
      useEffect(() => {
        if (isOpen && modalRef.current) {
          const focusable = modalRef.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
          if (focusable.length) focusable[0].focus();
        }
      }, [isOpen]);

      useEffect(() => {
        const handleTab = (e) => {
          if (!isOpen || !modalRef.current) return;
          const focusable = modalRef.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
          if (!focusable.length) return;
          const first = focusable[0];
          const last = focusable[focusable.length - 1];
          if (e.key === 'Tab') {
            if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
            else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
          }
        };
        window.addEventListener('keydown', handleTab);
        return () => window.removeEventListener('keydown', handleTab);
      }, [isOpen]);

      if (!isOpen) return null;
      return (
        <div role="dialog" aria-modal="true" aria-labelledby="modal-title" style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, padding: '1rem' }} onClick={onClose}>
          <div ref={modalRef} style={{ background: 'var(--bg-card)', borderRadius: '16px', width: '100%', maxWidth: width, maxHeight: '90vh', overflow: 'auto', boxShadow: '0 25px 50px -12px rgba(0,0,0,0.25)' }} onClick={e => e.stopPropagation()}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '1.25rem 1.5rem', borderBottom: '1px solid var(--border)' }}>
              <h3 id="modal-title" style={{ fontSize: '1.125rem', fontWeight: 600 }}>{title}</h3>
              <button onClick={onClose} aria-label="Close dialog" style={{ background: 'none', border: 'none', cursor: 'pointer', color: 'var(--text-muted)', padding: '0.25rem' }}><Icons.X aria-hidden="true" /></button>
            </div>
            <div style={{ padding: '1.5rem' }}>{children}</div>
          </div>
        </div>
      );
    };

    // PIN Pad Component
    const PinPad = ({ onSubmit, employees }) => {
      const [pin, setPin] = useState('');
      const [error, setError] = useState('');

      
      const handleDigit = (digit) => {
        if (pin.length < 4) {
          const newPin = pin + digit;
          setPin(newPin);
          setError('');
          
          if (newPin.length === 4) {
            const employee = employees.find(e => e.pin === newPin && e.active);
            if (employee) {
              onSubmit(employee);
              setPin('');
            } else {
              setError('Invalid PIN');
              setTimeout(() => { setPin(''); setError(''); }, 1000);
            }
          }
        }
      };

      const handleClear = () => { setPin(''); setError(''); };

      return (
        <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '1.5rem' }}>
          {/* PIN Display */}
          <div style={{ display: 'flex', gap: '0.75rem' }}>
            {[0, 1, 2, 3].map(i => (
              <div key={i} style={{
                width: '48px', height: '56px', borderRadius: '12px',
                background: 'var(--bg-tertiary)', border: error ? '2px solid var(--danger)' : '2px solid var(--border)',
                display: 'flex', alignItems: 'center', justifyContent: 'center',
                fontSize: '1.5rem', fontWeight: 700, fontFamily: "'DM Mono', monospace",
                transition: 'all 0.15s ease'
              }}>
                {pin[i] ? '‚Ä¢' : ''}
              </div>
            ))}
          </div>
          
          {error && <div style={{ color: 'var(--danger)', fontSize: '0.875rem', fontWeight: 500 }}>{error}</div>}

          {/* Number Pad */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '0.75rem' }}>
            {[1, 2, 3, 4, 5, 6, 7, 8, 9, null, 0, 'clear'].map((digit, i) => (
              digit === null ? <div key={i} /> :
              <button key={i} onClick={() => digit === 'clear' ? handleClear() : handleDigit(String(digit))}
                style={{
                  width: '72px', height: '72px', borderRadius: '16px',
                  background: digit === 'clear' ? 'var(--bg-tertiary)' : 'var(--bg-secondary)',
                  border: '2px solid var(--border)',
                  fontSize: digit === 'clear' ? '0.875rem' : '1.5rem',
                  fontWeight: 600, fontFamily: "'DM Mono', monospace",
                  color: 'var(--text-primary)', cursor: 'pointer',
                  transition: 'all 0.1s ease',
                }}
                onMouseDown={(e) => e.currentTarget.style.transform = 'scale(0.95)'}
                onMouseUp={(e) => e.currentTarget.style.transform = 'scale(1)'}
                onMouseLeave={(e) => e.currentTarget.style.transform = 'scale(1)'}
              >
                {digit === 'clear' ? 'Clear' : digit}
              </button>
            ))}
          </div>
        </div>
      );
    };

    // Main App
    
    // Help Modal Component
    const HelpModal = ({ isOpen, onClose }) => {
      if (!isOpen) return null;
      return (
        <div style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000 }} onClick={onClose}>
          <div style={{ background: 'var(--bg-card)', borderRadius: '12px', padding: '1.5rem', maxWidth: '500px', width: '90%', maxHeight: '80vh', overflow: 'auto', border: '1px solid var(--border)' }} onClick={e => e.stopPropagation()}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
              <h2 style={{ fontSize: '1.25rem', fontWeight: 700 }}>Help & About</h2>
              <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer', color: 'var(--text-muted)' }}>√ó</button>
            </div>
            
            <p style={{ color: 'var(--text-secondary)', marginBottom: '1rem' }}>
              PIN-based time clock with employee management and timesheet reports.
            </p>
            
            <div style={{ marginBottom: '1rem' }}>
              <h4 style={{ fontWeight: 600, marginBottom: '0.5rem' }}>‚å®Ô∏è Keyboard Shortcuts</h4>
              <div style={{ fontSize: '0.875rem', display: 'grid', gridTemplateColumns: '1fr 2fr', gap: '0.25rem' }}>
                <span style={{ fontFamily: 'monospace', background: 'var(--bg-tertiary)', padding: '0.125rem 0.375rem', borderRadius: '4px' }}>N</span><span>New item</span>
                <span style={{ fontFamily: 'monospace', background: 'var(--bg-tertiary)', padding: '0.125rem 0.375rem', borderRadius: '4px' }}>Esc</span><span>Close modals</span>
                <span style={{ fontFamily: 'monospace', background: 'var(--bg-tertiary)', padding: '0.125rem 0.375rem', borderRadius: '4px' }}>D</span><span>Toggle dark mode</span>
                <span style={{ fontFamily: 'monospace', background: 'var(--bg-tertiary)', padding: '0.125rem 0.375rem', borderRadius: '4px' }}>P</span><span>Print</span>
                <span style={{ fontFamily: 'monospace', background: 'var(--bg-tertiary)', padding: '0.125rem 0.375rem', borderRadius: '4px' }}>/</span><span>Focus search</span>
              </div>
            </div>
            
            <div style={{ marginBottom: '1rem' }}>
              <h4 style={{ fontWeight: 600, marginBottom: '0.5rem' }}>üí° Tips</h4>
              <ul style={{ fontSize: '0.875rem', color: 'var(--text-secondary)', paddingLeft: '1.25rem' }}>
                <li key="0">Employees clock in/out with PIN</li><li key="1">Review and approve timesheets</li><li key="2">Export for payroll processing</li>
              </ul>
            </div>
            
                <div style={{ marginTop: '1rem' }}>
                  <h4 style={{ fontWeight: 600, marginBottom: '0.5rem' }}>üì• Import Template</h4>
                  <p style={{ fontSize: '0.875rem', color: 'var(--text-secondary)', marginBottom: '0.5rem' }}>
                    Download a CSV template with the correct column headers:
                  </p>
                  <button 
                    onClick={() => {
                      const headers = "Name, PIN, Department, Hourly Rate";
                      const csv = headers + "\n";
                      const blob = new Blob([csv], { type: 'text/csv' });
                      const url = URL.createObjectURL(blob);
                      const a = document.createElement('a');
                      a.href = url;
                      a.download = 'crewclock-import-template.csv';
                      a.click();
                      URL.revokeObjectURL(url);
                    }}
                    style={{ background: 'var(--accent)', color: 'white', border: 'none', padding: '0.5rem 1rem', borderRadius: '6px', cursor: 'pointer', fontSize: '0.875rem' }}
                  >
                    Download Template
                  </button>
                </div>
            <div style={{ marginTop: '1.5rem', paddingTop: '1rem', borderTop: '1px solid var(--border)', fontSize: '0.75rem', color: 'var(--text-muted)', textAlign: 'center' }}>
              Press <kbd style={{ fontFamily: 'monospace', background: 'var(--bg-tertiary)', padding: '0.125rem 0.375rem', borderRadius: '4px' }}>?</kbd> anytime to open this help
            </div>
          </div>
        </div>
      );
    };

const App = () => {
      
      const APP_VERSION = '2.0.0';

      const [view, setView] = useState('clock');
      const [employees, setEmployees] = useState(() => load('crewclock_employees', DEFAULT_EMPLOYEES));
      const [jobs, setJobs] = useState(() => load('crewclock_jobs', DEFAULT_JOBS));
      const [entriesRaw, setEntriesRaw] = useState(() => load('crewclock_entries', []));
      const [settings, setSettings] = useState(() => load('crewclock_settings', { businessName: '', requireJob: false }));
      const [darkMode, setDarkMode] = useState(false);
      const [showHelp, setShowHelp] = useState(false);

      const [dateFrom, setDateFrom] = useState('');
      const [dateTo, setDateTo] = useState('');
      const [datePreset, setDatePreset] = useState('all');

      // Undo/Redo system
      const [history, setHistory] = useState([]);
      const [historyIndex, setHistoryIndex] = useState(-1);
      const maxHistory = 50;

      const entries = entriesRaw;
      const setEntries = (newDataOrFn) => {
        setEntriesRaw(prev => {
          const newData = typeof newDataOrFn === 'function' ? newDataOrFn(prev) : newDataOrFn;
          if (JSON.stringify(prev) !== JSON.stringify(newData)) {
            setHistory(h => {
              const newHistory = h.slice(0, historyIndex + 1);
              newHistory.push({ data: prev, timestamp: Date.now() });
              if (newHistory.length > maxHistory) newHistory.shift();
              return newHistory;
            });
            setHistoryIndex(i => Math.min(i + 1, maxHistory - 1));
          }
          return newData;
        });
      };

      const canUndo = historyIndex >= 0;
      const canRedo = historyIndex < history.length - 1;

      const undo = () => {
        if (!canUndo) return;
        const prevState = history[historyIndex];
        if (prevState) {
          setEntriesRaw(prevState.data);
          setHistoryIndex(i => i - 1);
          setSaveStatus('Undone');
          setTimeout(() => setSaveStatus(''), 2000);
        }
      };

      const redo = () => {
        if (!canRedo) return;
        const nextState = history[historyIndex + 2];
        if (nextState) {
          setEntriesRaw(nextState.data);
          setHistoryIndex(i => i + 1);
          setSaveStatus('Redone');
          setTimeout(() => setSaveStatus(''), 2000);
        } else if (historyIndex + 1 < history.length) {
          setHistoryIndex(i => i + 1);
        }
      };

      // Date preset helpers
      const getDatePresetRange = (preset) => {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const formatDateStr = (d) => d.toISOString().split('T')[0];
        switch (preset) {
          case 'today': return { from: formatDateStr(today), to: formatDateStr(today) };
          case 'week': const ws = new Date(today); ws.setDate(today.getDate() - today.getDay()); return { from: formatDateStr(ws), to: formatDateStr(today) };
          case 'month': return { from: formatDateStr(new Date(today.getFullYear(), today.getMonth(), 1)), to: formatDateStr(today) };
          case 'quarter': const qm = Math.floor(today.getMonth() / 3) * 3; return { from: formatDateStr(new Date(today.getFullYear(), qm, 1)), to: formatDateStr(today) };
          case 'year': return { from: formatDateStr(new Date(today.getFullYear(), 0, 1)), to: formatDateStr(today) };
          case 'last30': const l30 = new Date(today); l30.setDate(today.getDate() - 30); return { from: formatDateStr(l30), to: formatDateStr(today) };
          case 'last90': const l90 = new Date(today); l90.setDate(today.getDate() - 90); return { from: formatDateStr(l90), to: formatDateStr(today) };
          default: return { from: '', to: '' };
        }
      };
      const applyDatePreset = (preset) => { setDatePreset(preset); const r = getDatePresetRange(preset); setDateFrom(r.from); setDateTo(r.to); };

      // URL State Management
      useEffect(() => {
        const params = new URLSearchParams(window.location.search);
        if (params.get('view')) setView(params.get('view'));
        if (params.get('from')) setDateFrom(params.get('from'));
        if (params.get('to')) setDateTo(params.get('to'));
      }, []);

      useEffect(() => {
        const url = new URL(window.location);
        if (view !== 'dashboard') url.searchParams.set('view', view); else url.searchParams.delete('view');
        if (dateFrom) url.searchParams.set('from', dateFrom); else url.searchParams.delete('from');
        if (dateTo) url.searchParams.set('to', dateTo); else url.searchParams.delete('to');
        window.history.replaceState({}, '', url);
      }, [view]);
(() => localStorage.getItem('crewclock_darkMode') === 'true');
      // Keyboard shortcuts
      useEffect(() => {
        const handleKeyboard = (e) => {
          // Undo: Ctrl+Z
          if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
            e.preventDefault();
            undo();
            return;
          }
          // Redo: Ctrl+Shift+Z or Ctrl+Y
          if ((e.ctrlKey || e.metaKey) && (e.key === 'y' || (e.key === 'z' && e.shiftKey))) {
            e.preventDefault();
            redo();
            return;
          }

          // Skip if typing in input
          if (['INPUT', 'TEXTAREA', 'SELECT'].includes(e.target.tagName)) return;
          
          const key = e.key.toLowerCase();
          
          // Escape - close modals
          if (key === 'escape') {
            setShowEmployeeModal(false);
            setShowJobModal(false);
          }
          // N - new employee
          if (key === 'n' && !e.ctrlKey && !e.metaKey) {
            e.preventDefault();
            setShowEmployeeModal(true);
          }
          // D - toggle dark mode  
          if (key === 'd' && !e.ctrlKey && !e.metaKey) {
            setDarkMode(prev => !prev);
          }
          // P - print
          if (key === 'p' && !e.ctrlKey && !e.metaKey) {
            window.print();
          }
          // / - focus search
          if (key === '/') {
            e.preventDefault();
            const searchInput = document.querySelector('input[placeholder*="Search"], input[placeholder*="search"]');
            if (searchInput) searchInput.focus();
          }
          // 1-9 - switch views
          const viewKeys = ["dashboard", "entries", "employees", "settings"];
          const num = parseInt(key);
          if (num >= 1 && num <= viewKeys.length) {
            setView(viewKeys[num - 1]);
          }
        };
        
        window.addEventListener('keydown', handleKeyboard);
        return () => window.removeEventListener('keydown', handleKeyboard);
      }, [canUndo, canRedo, historyIndex, history]);

      
      const [selectedEmployee, setSelectedEmployee] = useState(null);
      const [showEmployeeModal, setShowEmployeeModal] = useState(false);
      const [editingEmployee, setEditingEmployee] = useState(null);
      const [showJobModal, setShowJobModal] = useState(false);
      const [editingJob, setEditingJob] = useState(null);
      const [saveStatus, setSaveStatus] = useState('');
      const [currentTime, setCurrentTime] = useState(new Date());

      // License system


      // Activity Log
      const [activityLog, setActivityLog] = useState(() => load('crewclock_activity', []));
      const logActivity = (action, entityType, entityName, details = '') => {
        const entry = { id: generateId(), timestamp: new Date().toISOString(), action, entityType, entityName, details };
        setActivityLog(prev => {
          const updated = [entry, ...prev].slice(0, 500);
          save('crewclock_activity', updated);
          return updated;
        });
      };

      // Auto-save
      useEffect(() => { save('crewclock_employees', employees); }, [employees]);
      useEffect(() => { save('crewclock_jobs', jobs); }, [jobs]);
      useEffect(() => { save('crewclock_entries', entries); }, [entries]);
      useEffect(() => { save('crewclock_settings', settings); }, [settings]);
      useEffect(() => { localStorage.setItem('crewclock_darkMode', darkMode); }, [darkMode]);

      // Clock update
      useEffect(() => {
        const timer = setInterval(() => setCurrentTime(new Date()), 1000);
        return () => clearInterval(timer);
      }, []);

      // Check who's clocked in
      const getActiveEntry = (employeeId) => entries.find(e => e.employeeId === employeeId && !e.clockOut);
      const clockedInEmployees = employees.filter(e => getActiveEntry(e.id));

      // Clock In/Out
      const handleClockAction = (employee, jobId = null) => {
        const activeEntry = getActiveEntry(employee.id);
        
        if (activeEntry) {
          // Clock Out
          const updatedEntries = entries.map(e => 
            e.id === activeEntry.id ? { ...e, clockOut: new Date().toISOString() } : e
          );
          setEntries(updatedEntries);
          logActivity('Clock Out', 'Time Entry', employee.name, formatTime(new Date()));
          setSaveStatus(`${employee.name} clocked out!`);
        } else {
          // Clock In
          
          const newEntry = {
            id: generateId(),
            employeeId: employee.id,
            jobId: jobId || null,
            clockIn: new Date().toISOString(),
            clockOut: null,
            notes: ''
          };
          setEntries([...entries, newEntry]);
          logActivity('Clock In', 'Time Entry', employee.name, formatTime(new Date()));
          setSaveStatus(`${employee.name} clocked in!`);
        }
        
        setSelectedEmployee(null);
        setTimeout(() => setSaveStatus(''), 3000);
      };

      // Employee PIN entry
      const handlePinEntry = (employee) => {
        const activeEntry = getActiveEntry(employee.id);
        if (activeEntry || !settings.requireJob) {
          handleClockAction(employee);
        } else {
          setSelectedEmployee(employee);
        }
      };

      // Employee CRUD
      const saveEmployee = (emp) => {
        const isNew = !employees.find(e => e.id === emp.id);
        if (isNew) {
          setEmployees([...employees, emp]);
          logActivity('Created', 'Employee', emp.name);
        } else {
          setEmployees(employees.map(e => e.id === emp.id ? emp : e));
          logActivity('Updated', 'Employee', emp.name);
        }
        setEditingEmployee(null);
        setShowEmployeeModal(false);
      };

      const deleteEmployee = (id) => {
        const emp = employees.find(e => e.id === id);
        if (confirm(`Delete ${emp.name}? Their time entries will be preserved.`)) {
          setEmployees(employees.filter(e => e.id !== id));
          logActivity('Deleted', 'Employee', emp.name);
        }
      };

      // Job CRUD
      const saveJob = (job) => {
        const isNew = !jobs.find(j => j.id === job.id);
        if (isNew) {
          setJobs([...jobs, job]);
          logActivity('Created', 'Job', job.name);
        } else {
          setJobs(jobs.map(j => j.id === job.id ? job : j));
          logActivity('Updated', 'Job', job.name);
        }
        setEditingJob(null);
        setShowJobModal(false);
      };

      const deleteJob = (id) => {
        const job = jobs.find(j => j.id === id);
        if (confirm(`Delete ${job.name}?`)) {
          setJobs(jobs.filter(j => j.id !== id));
          logActivity('Deleted', 'Job', job.name);
        }
      };

      // Reports data
      const [reportRange, setReportRange] = useState('week');
      const getReportDates = () => {
        const end = new Date();
        const start = new Date();
        if (reportRange === 'today') start.setHours(0, 0, 0, 0);
        else if (reportRange === 'week') start.setDate(start.getDate() - 7);
        else if (reportRange === 'month') start.setMonth(start.getMonth() - 1);
        else if (reportRange === 'year') start.setFullYear(start.getFullYear() - 1);
        return { start, end };
      };

      const getFilteredEntries = () => {
        const { start, end } = getReportDates();
        return entries.filter(e => {
          const clockIn = new Date(e.clockIn);
          return clockIn >= start && clockIn <= end;
        });
      };

      // Export
      const exportCSV = () => {
        const filtered = getFilteredEntries();
        const csv = ['Employee,Job,Date,Clock In,Clock Out,Hours,Notes',
          ...filtered.map(e => {
            const emp = employees.find(x => x.id === e.employeeId);
            const job = jobs.find(x => x.id === e.jobId);
            const mins = e.clockOut ? getMinutesBetween(e.clockIn, e.clockOut) : 0;
            return `"${emp?.name || 'Unknown'}","${job?.name || ''}","${new Date(e.clockIn).toLocaleDateString()}","${formatTime(e.clockIn)}","${e.clockOut ? formatTime(e.clockOut) : 'Active'}","${(mins/60).toFixed(2)}","${e.notes || ''}"`;
          })
        ].join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `crewclock-${reportRange}-${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
        logActivity('Exported', 'Report', reportRange);
      };

      const exportData = () => {
        const data = { employees, jobs, entries, settings, exportedAt: new Date().toISOString() };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `crewclock-backup-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
      };

      // PDF Export - Timesheet
      const exportTimesheetPdf = async () => {
        const filtered = getFilteredEntries().filter(e => e.clockOut);
        const totalMins = filtered.reduce((sum, e) => sum + getMinutesBetween(e.clockIn, e.clockOut), 0);
        
        // Group by employee
        const byEmployee = {};
        filtered.forEach(e => {
          const emp = employees.find(x => x.id === e.employeeId);
          const name = emp?.name || 'Unknown';
          if (!byEmployee[name]) byEmployee[name] = { entries: [], totalMins: 0 };
          byEmployee[name].entries.push(e);
          byEmployee[name].totalMins += getMinutesBetween(e.clockIn, e.clockOut);
        });
        
        const content = document.createElement('div');
        content.style.cssText = 'padding: 40px; font-family: system-ui, sans-serif; max-width: 800px; background: white; color: #1a1a1a;';
        
        content.innerHTML = `
          <div style="text-align: center; margin-bottom: 30px;">
            <h1 style="font-size: 24px; margin: 0 0 5px 0;">${settings.companyName || 'Timesheet Report'}</h1>
            <p style="color: #666; margin: 0;">Period: ${reportRange.charAt(0).toUpperCase() + reportRange.slice(1)}</p>
            <p style="color: #999; font-size: 12px; margin: 5px 0 0 0;">Generated: ${new Date().toLocaleDateString()}</p>
          </div>
          
          <div style="display: flex; justify-content: space-around; margin-bottom: 30px; text-align: center; background: #f5f5f5; padding: 15px; border-radius: 8px;">
            <div><div style="font-size: 24px; font-weight: bold;">${filtered.length}</div><div style="color: #666; font-size: 12px;">Entries</div></div>
            <div><div style="font-size: 24px; font-weight: bold; color: #2563eb;">${(totalMins / 60).toFixed(1)}</div><div style="color: #666; font-size: 12px;">Total Hours</div></div>
            <div><div style="font-size: 24px; font-weight: bold;">${Object.keys(byEmployee).length}</div><div style="color: #666; font-size: 12px;">Employees</div></div>
          </div>
          
          ${Object.entries(byEmployee).map(([name, data]) => `
            <div style="margin-bottom: 25px;">
              <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #2563eb; padding-bottom: 5px; margin-bottom: 10px;">
                <h3 style="margin: 0; font-size: 14px;">${name}</h3>
                <span style="font-weight: bold; color: #2563eb;">${(data.totalMins / 60).toFixed(2)} hrs</span>
              </div>
              <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                <thead>
                  <tr style="background: #f9f9f9;">
                    <th style="text-align: left; padding: 6px;">Date</th>
                    <th style="text-align: left; padding: 6px;">Job</th>
                    <th style="text-align: left; padding: 6px;">In</th>
                    <th style="text-align: left; padding: 6px;">Out</th>
                    <th style="text-align: right; padding: 6px;">Hours</th>
                  </tr>
                </thead>
                <tbody>
                  ${data.entries.sort((a, b) => new Date(a.clockIn) - new Date(b.clockIn)).map(e => {
                    const job = jobs.find(x => x.id === e.jobId);
                    const mins = getMinutesBetween(e.clockIn, e.clockOut);
                    return `<tr style="border-bottom: 1px solid #eee;">
                      <td style="padding: 6px;">${new Date(e.clockIn).toLocaleDateString()}</td>
                      <td style="padding: 6px;">${job?.name || '‚Äî'}</td>
                      <td style="padding: 6px;">${formatTime(e.clockIn)}</td>
                      <td style="padding: 6px;">${formatTime(e.clockOut)}</td>
                      <td style="padding: 6px; text-align: right; font-weight: 500;">${(mins / 60).toFixed(2)}</td>
                    </tr>`;
                  }).join('')}
                </tbody>
              </table>
            </div>
          `).join('')}
        `;
        
        document.body.appendChild(content);
        await html2pdf().set({
          margin: 0.5,
          filename: `timesheet-${reportRange}-${new Date().toISOString().split('T')[0]}.pdf`,
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
        }).from(content).save();
        document.body.removeChild(content);
        logActivity('Exported', 'PDF Report', reportRange);
      };

      const importData = (e) => {
        const file = e.target.files?.[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const data = JSON.parse(event.target.result);
            if (data.employees) setEmployees(data.employees);
            if (data.jobs) setJobs(data.jobs);
            if (data.entries) setEntries(data.entries);
            if (data.settings) setSettings(data.settings);
            setSaveStatus('Imported!');
            setTimeout(() => setSaveStatus(''), 2000);
          } catch { alert('Invalid file'); }
        };
        reader.readAsText(file);
        e.target.value = '';
      };

      const fileInputRef = useRef(null);

      // Calculate stats
      const todayEntries = entries.filter(e => {
        const d = new Date(e.clockIn);
        const today = new Date();
        return d.toDateString() === today.toDateString();
      });
      
      const todayHours = todayEntries.reduce((sum, e) => {
        if (e.clockOut) return sum + getMinutesBetween(e.clockIn, e.clockOut);
        return sum + getMinutesBetween(e.clockIn, new Date());
      }, 0) / 60;

      return (
        <div className={darkMode ? 'dark' : ''} style={{ minHeight: '100vh', background: 'var(--bg-primary)' }}>
          {/* Header */}
          <header style={{ background: 'var(--bg-secondary)', borderBottom: '1px solid var(--border)', padding: '0.75rem 1.5rem', position: 'sticky', top: 0, zIndex: 100 }}>
            <div style={{ maxWidth: '1200px', margin: '0 auto', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                  <div style={{ width: '36px', height: '36px', background: 'linear-gradient(135deg, var(--accent) 0%, #06b6d4 100%)', borderRadius: '10px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                    <Icons.Clock style={{ color: 'white' }} />
                  </div>
                  <span style={{ fontWeight: 700, fontSize: '1.125rem' }}>{settings.businessName || 'CrewClock'}</span>
                </div>
                <nav role="navigation" aria-label="Main navigation" style={{ display: 'flex', gap: '0.25rem' }}>
                  <Button variant={view === 'clock' ? 'secondary' : 'ghost'} size="sm" onClick={() => setView('clock')}><Icons.Clock /> Clock</Button>
                  <Button variant={view === 'timesheet' ? 'secondary' : 'ghost'} size="sm" onClick={() => setView('timesheet')}><Icons.List /> Timesheet</Button>
                  <Button variant={view === 'employees' ? 'secondary' : 'ghost'} size="sm" onClick={() => setView('employees')}><Icons.Users /> Employees</Button>
                  <Button variant={view === 'jobs' ? 'secondary' : 'ghost'} size="sm" onClick={() => setView('jobs')}><Icons.Briefcase /> Jobs</Button>
                  <Button variant={view === 'reports' ? 'secondary' : 'ghost'} size="sm" onClick={() => setView('reports')}><Icons.BarChart /> Reports</Button>
                  <Button variant={view === 'activity' ? 'secondary' : 'ghost'} size="sm" onClick={() => setView('activity')}><Icons.FileText /> Activity</Button>
                  <Button variant={view === 'settings' ? 'secondary' : 'ghost'} size="sm" onClick={() => setView('settings')}><Icons.Settings /></Button>
                </nav>
              </div>
              <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                <span role="status" aria-live="polite" aria-atomic="true">{saveStatus && <span style={{ color: 'var(--success)', fontSize: '0.875rem', fontWeight: 500 }}><Icons.Check aria-hidden="true" /> {saveStatus}</span>}</span>
                <div style={{ display: 'flex', gap: '0.25rem' }}>
                  <Button variant="ghost" size="sm" onClick={undo} disabled={!canUndo} title="Undo (Ctrl+Z)">
                    <Icons.RotateCcw />
                  </Button>
                  <Button variant="ghost" size="sm" onClick={redo} disabled={!canRedo} title="Redo (Ctrl+Y)">
                    <Icons.RotateCw />
                  </Button>
                </div>
                <button onClick={() => setShowHelp(true)} title="Help" style={{ background: 'var(--bg-tertiary)', border: '1px solid var(--border)', borderRadius: '8px', padding: '0.5rem', cursor: 'pointer', color: 'var(--text-primary)', fontSize: '1rem' }}>‚ùì</button>
              <button onClick={() => setDarkMode(!darkMode)} style={{ background: 'var(--bg-tertiary)', border: '1px solid var(--border)', borderRadius: '8px', padding: '0.5rem', cursor: 'pointer', color: 'var(--text-primary)' }}>
                  {darkMode ? '‚òÄÔ∏è' : 'üåô'}
                </button>
                <span style={{ fontSize: '0.625rem', color: 'var(--text-muted)', padding: '0.25rem 0.5rem', background: 'var(--bg-tertiary)', borderRadius: '4px' }}>v{APP_VERSION}</span>
              </div>
            </div>
          </header>

          {/* Main */}
          <main id="main-content" role="main" style={{ padding: '2rem 1.5rem', maxWidth: '1200px', margin: '0 auto' }}>
            
            {/* Clock View */}
            {view === 'clock' && (
              <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '2rem' }}>
                {/* Current Time */}
                <div style={{ textAlign: 'center' }}>
                  <div style={{ fontSize: '4rem', fontWeight: 700, fontFamily: "'DM Mono', monospace", letterSpacing: '-2px' }}>
                    {currentTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' })}
                  </div>
                  <div style={{ fontSize: '1.125rem', color: 'var(--text-secondary)' }}>
                    {currentTime.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}
                  </div>
                </div>

                {/* Who's Clocked In */}
                {clockedInEmployees.length > 0 && (
                  <div style={{ background: 'var(--bg-secondary)', borderRadius: '16px', padding: '1.25rem', border: '1px solid var(--border)', width: '100%', maxWidth: '400px' }}>
                    <h3 style={{ fontSize: '0.875rem', fontWeight: 600, color: 'var(--text-muted)', marginBottom: '0.75rem', textTransform: 'uppercase', letterSpacing: '0.05em' }}>Currently Working</h3>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                      {clockedInEmployees.map(emp => {
                        const entry = getActiveEntry(emp.id);
                        const mins = getMinutesBetween(entry.clockIn, new Date());
                        return (
                          <div key={emp.id} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0.5rem 0.75rem', background: 'var(--bg-tertiary)', borderRadius: '8px' }}>
                            <span style={{ fontWeight: 500 }}>{emp.name}</span>
                            <span style={{ fontFamily: "'DM Mono', monospace", color: 'var(--success)', fontWeight: 600 }}>{formatDuration(mins)}</span>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}

                {/* PIN Pad or Job Selection */}
                {!selectedEmployee ? (
                  <div style={{ background: 'var(--bg-secondary)', borderRadius: '24px', padding: '2rem', border: '1px solid var(--border)', boxShadow: '0 4px 20px rgba(0,0,0,0.08)' }}>
                    <h2 style={{ textAlign: 'center', marginBottom: '1.5rem', fontSize: '1.25rem', fontWeight: 600 }}>Enter Your PIN</h2>
                    <PinPad onSubmit={handlePinEntry} employees={employees} />
                  </div>
                ) : (
                  <div style={{ background: 'var(--bg-secondary)', borderRadius: '24px', padding: '2rem', border: '1px solid var(--border)', boxShadow: '0 4px 20px rgba(0,0,0,0.08)', width: '100%', maxWidth: '400px' }}>
                    <h2 style={{ textAlign: 'center', marginBottom: '0.5rem', fontSize: '1.25rem', fontWeight: 600 }}>Welcome, {selectedEmployee.name}</h2>
                    <p style={{ textAlign: 'center', color: 'var(--text-muted)', marginBottom: '1.5rem' }}>Select a job to clock in</p>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                      {jobs.filter(j => j.active).map(job => (
                        <button key={job.id} onClick={() => handleClockAction(selectedEmployee, job.id)}
                          style={{ padding: '1rem', background: 'var(--bg-tertiary)', border: '2px solid var(--border)', borderRadius: '12px', cursor: 'pointer', textAlign: 'left', transition: 'all 0.15s ease' }}
                          onMouseEnter={e => e.currentTarget.style.borderColor = 'var(--accent)'}
                          onMouseLeave={e => e.currentTarget.style.borderColor = 'var(--border)'}>
                          <div style={{ fontWeight: 600, color: 'var(--text-primary)' }}>{job.name}</div>
                          <div style={{ fontSize: '0.8125rem', color: 'var(--text-muted)' }}>{job.code}</div>
                        </button>
                      ))}
                    </div>
                    <Button variant="ghost" onClick={() => setSelectedEmployee(null)} style={{ width: '100%', marginTop: '1rem' }}>Cancel</Button>
                  </div>
                )}

                {/* Today's Stats */}
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '1rem', width: '100%', maxWidth: '600px' }}>
                  <div style={{ background: 'var(--bg-secondary)', borderRadius: '12px', padding: '1.25rem', border: '1px solid var(--border)', textAlign: 'center' }}>
                    <div style={{ fontSize: '2rem', fontWeight: 700, fontFamily: "'DM Mono', monospace", color: 'var(--accent)' }}>{clockedInEmployees.length}</div>
                    <div style={{ fontSize: '0.8125rem', color: 'var(--text-muted)' }}>Clocked In</div>
                  </div>
                  <div style={{ background: 'var(--bg-secondary)', borderRadius: '12px', padding: '1.25rem', border: '1px solid var(--border)', textAlign: 'center' }}>
                    <div style={{ fontSize: '2rem', fontWeight: 700, fontFamily: "'DM Mono', monospace", color: 'var(--success)' }}>{todayEntries.length}</div>
                    <div style={{ fontSize: '0.8125rem', color: 'var(--text-muted)' }}>Today's Entries</div>
                  </div>
                  <div style={{ background: 'var(--bg-secondary)', borderRadius: '12px', padding: '1.25rem', border: '1px solid var(--border)', textAlign: 'center' }}>
                    <div style={{ fontSize: '2rem', fontWeight: 700, fontFamily: "'DM Mono', monospace", color: 'var(--warning)' }}>{todayHours.toFixed(1)}</div>
                    <div style={{ fontSize: '0.8125rem', color: 'var(--text-muted)' }}>Hours Today</div>
                  </div>
                </div>
              </div>
            )}

            {/* Timesheet View */}
            {view === 'timesheet' && (
              <div>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                  <h2 style={{ fontSize: '1.5rem', fontWeight: 700 }}>Timesheet</h2>
                  <div style={{ display: 'flex', gap: '0.5rem' }}>
                    <Select value={reportRange} onChange={setReportRange} options={[
                      { value: 'today', label: 'Today' },
                      { value: 'week', label: 'Last 7 Days' },
                      { value: 'month', label: 'Last 30 Days' },
                      { value: 'year', label: 'Last Year' },
                    ]} />
                    <Button variant="secondary" onClick={exportCSV}><Icons.Download /> CSV</Button>
                    <Button variant="secondary" onClick={exportTimesheetPdf}><Icons.FileText /> PDF</Button>
                  </div>
                </div>

                {getFilteredEntries().length === 0 ? (
                  <div style={{ textAlign: 'center', padding: '4rem', background: 'var(--bg-secondary)', borderRadius: '16px', border: '1px solid var(--border)' }}>
                    <Icons.Clock style={{ width: 48, height: 48, color: 'var(--text-muted)', marginBottom: '1rem' }} />
                    <p style={{ color: 'var(--text-muted)' }}>No time entries for this period</p>
                  </div>
                ) : (
                  <div style={{ background: 'var(--bg-secondary)', borderRadius: '16px', border: '1px solid var(--border)', overflow: 'hidden' }}>
                    <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                      <thead>
                        <tr style={{ background: 'var(--bg-tertiary)' }}>
                          <th style={{ textAlign: 'left', padding: '1rem', fontSize: '0.75rem', fontWeight: 600, color: 'var(--text-muted)', textTransform: 'uppercase' }}>Employee</th>
                          <th style={{ textAlign: 'left', padding: '1rem', fontSize: '0.75rem', fontWeight: 600, color: 'var(--text-muted)', textTransform: 'uppercase' }}>Job</th>
                          <th style={{ textAlign: 'left', padding: '1rem', fontSize: '0.75rem', fontWeight: 600, color: 'var(--text-muted)', textTransform: 'uppercase' }}>Date</th>
                          <th style={{ textAlign: 'left', padding: '1rem', fontSize: '0.75rem', fontWeight: 600, color: 'var(--text-muted)', textTransform: 'uppercase' }}>In</th>
                          <th style={{ textAlign: 'left', padding: '1rem', fontSize: '0.75rem', fontWeight: 600, color: 'var(--text-muted)', textTransform: 'uppercase' }}>Out</th>
                          <th style={{ textAlign: 'right', padding: '1rem', fontSize: '0.75rem', fontWeight: 600, color: 'var(--text-muted)', textTransform: 'uppercase' }}>Hours</th>
                        </tr>
                      </thead>
                      <tbody>
                        {getFilteredEntries().sort((a, b) => new Date(b.clockIn) - new Date(a.clockIn)).map(entry => {
                          const emp = employees.find(e => e.id === entry.employeeId);
                          const job = jobs.find(j => j.id === entry.jobId);
                          const mins = entry.clockOut ? getMinutesBetween(entry.clockIn, entry.clockOut) : getMinutesBetween(entry.clockIn, new Date());
                          return (
                            <tr key={entry.id} style={{ borderBottom: '1px solid var(--border)' }}>
                              <td style={{ padding: '1rem', fontWeight: 500 }}>{emp?.name || 'Unknown'}</td>
                              <td style={{ padding: '1rem', color: 'var(--text-secondary)' }}>{job?.name || '‚Äî'}</td>
                              <td style={{ padding: '1rem', color: 'var(--text-secondary)' }}>{formatDate(entry.clockIn)}</td>
                              <td style={{ padding: '1rem', fontFamily: "'DM Mono', monospace" }}>{formatTime(entry.clockIn)}</td>
                              <td style={{ padding: '1rem', fontFamily: "'DM Mono', monospace" }}>
                                {entry.clockOut ? formatTime(entry.clockOut) : <span style={{ color: 'var(--success)', fontWeight: 600 }}>Active</span>}
                              </td>
                              <td style={{ padding: '1rem', textAlign: 'right', fontFamily: "'DM Mono', monospace", fontWeight: 600 }}>{formatDuration(mins)}</td>
                            </tr>
                          );
                        })}
                      </tbody>
                    </table>
                  </div>
                )}
              </div>
            )}

            {/* Employees View */}
            {view === 'employees' && (
              <div>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                  <h2 style={{ fontSize: '1.5rem', fontWeight: 700 }}>Employees</h2>
                  <Button onClick={() => { setEditingEmployee(null); setShowEmployeeModal(true); }}><Icons.Plus /> Add Employee</Button>
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))', gap: '1rem' }}>
                  {employees.map(emp => {
                    const isActive = getActiveEntry(emp.id);
                    const totalMins = entries.filter(e => e.employeeId === emp.id && e.clockOut).reduce((sum, e) => sum + getMinutesBetween(e.clockIn, e.clockOut), 0);
                    return (
                      <div key={emp.id} style={{ background: 'var(--bg-secondary)', borderRadius: '12px', padding: '1.25rem', border: '1px solid var(--border)', opacity: emp.active ? 1 : 0.6 }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '0.75rem' }}>
                          <div>
                            <div style={{ fontWeight: 600, display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                              {emp.name}
                              {isActive && <span style={{ width: 8, height: 8, background: 'var(--success)', borderRadius: '50%' }} title="Clocked In" />}
                            </div>
                            <div style={{ fontSize: '0.875rem', color: 'var(--text-muted)' }}>{emp.role}</div>
                          </div>
                          <div style={{ display: 'flex', gap: '0.25rem' }}>
                            <Button variant="ghost" size="sm" onClick={() => { setEditingEmployee(emp); setShowEmployeeModal(true); }}><Icons.Edit /></Button>
                            <Button variant="ghost" size="sm" onClick={() => deleteEmployee(emp.id)} style={{ color: 'var(--danger)' }}><Icons.Trash /></Button>
                          </div>
                        </div>
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '0.5rem', fontSize: '0.8125rem' }}>
                          <div><span style={{ color: 'var(--text-muted)' }}>PIN:</span> <span style={{ fontFamily: "'DM Mono', monospace" }}>{emp.pin}</span></div>
                          <div><span style={{ color: 'var(--text-muted)' }}>Rate:</span> ${emp.hourlyRate}/hr</div>
                          <div style={{ gridColumn: 'span 2' }}><span style={{ color: 'var(--text-muted)' }}>Total Hours:</span> <span style={{ fontWeight: 600 }}>{formatDuration(totalMins)}</span></div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {/* Jobs View */}
            {view === 'jobs' && (
              <div>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                  <h2 style={{ fontSize: '1.5rem', fontWeight: 700 }}>Jobs / Projects</h2>
                  <Button onClick={() => { setEditingJob(null); setShowJobModal(true); }}><Icons.Plus /> Add Job</Button>
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))', gap: '1rem' }}>
                  {jobs.map(job => {
                    const totalMins = entries.filter(e => e.jobId === job.id && e.clockOut).reduce((sum, e) => sum + getMinutesBetween(e.clockIn, e.clockOut), 0);
                    const entryCount = entries.filter(e => e.jobId === job.id).length;
                    return (
                      <div key={job.id} style={{ background: 'var(--bg-secondary)', borderRadius: '12px', padding: '1.25rem', border: '1px solid var(--border)', opacity: job.active ? 1 : 0.6 }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '0.75rem' }}>
                          <div>
                            <div style={{ fontWeight: 600 }}>{job.name}</div>
                            <div style={{ fontSize: '0.875rem', color: 'var(--text-muted)', fontFamily: "'DM Mono', monospace" }}>{job.code}</div>
                          </div>
                          <div style={{ display: 'flex', gap: '0.25rem' }}>
                            <Button variant="ghost" size="sm" onClick={() => { setEditingJob(job); setShowJobModal(true); }}><Icons.Edit /></Button>
                            <Button variant="ghost" size="sm" onClick={() => deleteJob(job.id)} style={{ color: 'var(--danger)' }}><Icons.Trash /></Button>
                          </div>
                        </div>
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '0.5rem', fontSize: '0.8125rem' }}>
                          <div><span style={{ color: 'var(--text-muted)' }}>Entries:</span> {entryCount}</div>
                          <div><span style={{ color: 'var(--text-muted)' }}>Hours:</span> <span style={{ fontWeight: 600 }}>{formatDuration(totalMins)}</span></div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {/* Reports View */}
            {view === 'reports' && (
              <div>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                  <h2 style={{ fontSize: '1.5rem', fontWeight: 700 }}>Reports</h2>
                  <Select value={reportRange} onChange={setReportRange} options={[
                    { value: 'today', label: 'Today' },
                    { value: 'week', label: 'Last 7 Days' },
                    { value: 'month', label: 'Last 30 Days' },
                    { value: 'year', label: 'Last Year' },
                  ]} />
                </div>

                {/* Summary Cards */}
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '1rem', marginBottom: '2rem' }}>
                  {(() => {
                    const filtered = getFilteredEntries();
                    const totalMins = filtered.filter(e => e.clockOut).reduce((sum, e) => sum + getMinutesBetween(e.clockIn, e.clockOut), 0);
                    const totalCost = filtered.filter(e => e.clockOut).reduce((sum, e) => {
                      const emp = employees.find(x => x.id === e.employeeId);
                      return sum + (getMinutesBetween(e.clockIn, e.clockOut) / 60) * (emp?.hourlyRate || 0);
                    }, 0);
                    const uniqueEmployees = new Set(filtered.map(e => e.employeeId)).size;
                    return (
                      <>
                        <div style={{ background: 'var(--bg-secondary)', borderRadius: '12px', padding: '1.5rem', border: '1px solid var(--border)' }}>
                          <div style={{ fontSize: '0.75rem', color: 'var(--text-muted)', textTransform: 'uppercase', marginBottom: '0.5rem' }}>Total Hours</div>
                          <div style={{ fontSize: '2rem', fontWeight: 700, fontFamily: "'DM Mono', monospace", color: 'var(--accent)' }}>{formatDuration(totalMins)}</div>
                        </div>
                        <div style={{ background: 'var(--bg-secondary)', borderRadius: '12px', padding: '1.5rem', border: '1px solid var(--border)' }}>
                          <div style={{ fontSize: '0.75rem', color: 'var(--text-muted)', textTransform: 'uppercase', marginBottom: '0.5rem' }}>Labor Cost</div>
                          <div style={{ fontSize: '2rem', fontWeight: 700, fontFamily: "'DM Mono', monospace", color: 'var(--warning)' }}>${totalCost.toFixed(2)}</div>
                        </div>
                        <div style={{ background: 'var(--bg-secondary)', borderRadius: '12px', padding: '1.5rem', border: '1px solid var(--border)' }}>
                          <div style={{ fontSize: '0.75rem', color: 'var(--text-muted)', textTransform: 'uppercase', marginBottom: '0.5rem' }}>Entries</div>
                          <div style={{ fontSize: '2rem', fontWeight: 700, fontFamily: "'DM Mono', monospace", color: 'var(--success)' }}>{filtered.length}</div>
                        </div>
                        <div style={{ background: 'var(--bg-secondary)', borderRadius: '12px', padding: '1.5rem', border: '1px solid var(--border)' }}>
                          <div style={{ fontSize: '0.75rem', color: 'var(--text-muted)', textTransform: 'uppercase', marginBottom: '0.5rem' }}>Employees</div>
                          <div style={{ fontSize: '2rem', fontWeight: 700, fontFamily: "'DM Mono', monospace", color: 'var(--info)' }}>{uniqueEmployees}</div>
                        </div>
                      </>
                    );
                  })()}
                </div>

                {/* Hours by Employee */}
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1.5rem' }}>
                  <div style={{ background: 'var(--bg-secondary)', borderRadius: '16px', padding: '1.5rem', border: '1px solid var(--border)' }}>
                    <h3 style={{ fontSize: '1rem', fontWeight: 600, marginBottom: '1rem' }}>Hours by Employee</h3>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                      {employees.map(emp => {
                        const empMins = getFilteredEntries().filter(e => e.employeeId === emp.id && e.clockOut).reduce((sum, e) => sum + getMinutesBetween(e.clockIn, e.clockOut), 0);
                        const maxMins = Math.max(...employees.map(x => getFilteredEntries().filter(e => e.employeeId === x.id && e.clockOut).reduce((sum, e) => sum + getMinutesBetween(e.clockIn, e.clockOut), 0)), 1);
                        return (
                          <div key={emp.id}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.25rem' }}>
                              <span style={{ fontSize: '0.875rem' }}>{emp.name}</span>
                              <span style={{ fontSize: '0.875rem', fontFamily: "'DM Mono', monospace", fontWeight: 600 }}>{formatDuration(empMins)}</span>
                            </div>
                            <div style={{ height: '8px', background: 'var(--bg-tertiary)', borderRadius: '4px', overflow: 'hidden' }}>
                              <div style={{ height: '100%', width: `${(empMins / maxMins) * 100}%`, background: 'var(--accent)', borderRadius: '4px', transition: 'width 0.3s ease' }} />
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  <div style={{ background: 'var(--bg-secondary)', borderRadius: '16px', padding: '1.5rem', border: '1px solid var(--border)' }}>
                    <h3 style={{ fontSize: '1rem', fontWeight: 600, marginBottom: '1rem' }}>Hours by Job</h3>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                      {jobs.map(job => {
                        const jobMins = getFilteredEntries().filter(e => e.jobId === job.id && e.clockOut).reduce((sum, e) => sum + getMinutesBetween(e.clockIn, e.clockOut), 0);
                        const maxMins = Math.max(...jobs.map(x => getFilteredEntries().filter(e => e.jobId === x.id && e.clockOut).reduce((sum, e) => sum + getMinutesBetween(e.clockIn, e.clockOut), 0)), 1);
                        return (
                          <div key={job.id}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.25rem' }}>
                              <span style={{ fontSize: '0.875rem' }}>{job.name}</span>
                              <span style={{ fontSize: '0.875rem', fontFamily: "'DM Mono', monospace", fontWeight: 600 }}>{formatDuration(jobMins)}</span>
                            </div>
                            <div style={{ height: '8px', background: 'var(--bg-tertiary)', borderRadius: '4px', overflow: 'hidden' }}>
                              <div style={{ height: '100%', width: `${(jobMins / maxMins) * 100}%`, background: 'var(--success)', borderRadius: '4px', transition: 'width 0.3s ease' }} />
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>

                <div style={{ marginTop: '1.5rem' }}>
                  <Button variant="secondary" onClick={exportCSV}><Icons.Download /> CSV</Button>
                  <Button variant="secondary" onClick={exportTimesheetPdf}><Icons.FileText /> PDF</Button>
                </div>
              </div>
            )}

            {/* Activity Log View */}
            {view === 'activity' && (
              <div>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                  <h2 style={{ fontSize: '1.5rem', fontWeight: 700 }}>Activity Log</h2>
                  <div style={{ display: 'flex', gap: '0.5rem' }}>
                    <Button variant="secondary" size="sm" onClick={() => {
                      const csv = ['Timestamp,Action,Type,Name,Details', ...activityLog.map(a => 
                        `"${new Date(a.timestamp).toLocaleString()}","${a.action}","${a.entityType}","${a.entityName}","${a.details || ''}"`
                      )].join('\n');
                      const blob = new Blob([csv], { type: 'text/csv' });
                      const link = document.createElement('a');
                      link.href = URL.createObjectURL(blob);
                      link.download = `activity-log-${new Date().toISOString().split('T')[0]}.csv`;
                      link.click();
                    }}><Icons.Download /> Export</Button>
                    {activityLog.length > 0 && (
                      <Button variant="danger" size="sm" onClick={() => { if (confirm('Clear activity log?')) { setActivityLog([]); save('crewclock_activity', []); }}}>Clear</Button>
                    )}
                  </div>
                </div>

                {activityLog.length === 0 ? (
                  <div style={{ textAlign: 'center', padding: '4rem', background: 'var(--bg-secondary)', borderRadius: '16px', border: '1px solid var(--border)' }}>
                    <p style={{ color: 'var(--text-muted)' }}>No activity recorded yet</p>
                  </div>
                ) : (
                  <div style={{ background: 'var(--bg-secondary)', borderRadius: '16px', border: '1px solid var(--border)', overflow: 'hidden' }}>
                    <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                      <thead>
                        <tr style={{ background: 'var(--bg-tertiary)' }}>
                          <th style={{ textAlign: 'left', padding: '1rem', fontSize: '0.75rem', fontWeight: 600, color: 'var(--text-muted)', textTransform: 'uppercase' }}>Time</th>
                          <th style={{ textAlign: 'left', padding: '1rem', fontSize: '0.75rem', fontWeight: 600, color: 'var(--text-muted)', textTransform: 'uppercase' }}>Action</th>
                          <th style={{ textAlign: 'left', padding: '1rem', fontSize: '0.75rem', fontWeight: 600, color: 'var(--text-muted)', textTransform: 'uppercase' }}>Type</th>
                          <th style={{ textAlign: 'left', padding: '1rem', fontSize: '0.75rem', fontWeight: 600, color: 'var(--text-muted)', textTransform: 'uppercase' }}>Name</th>
                          <th style={{ textAlign: 'left', padding: '1rem', fontSize: '0.75rem', fontWeight: 600, color: 'var(--text-muted)', textTransform: 'uppercase' }}>Details</th>
                        </tr>
                      </thead>
                      <tbody>
                        {activityLog.slice(0, 100).map(entry => (
                          <tr key={entry.id} style={{ borderBottom: '1px solid var(--border)' }}>
                            <td style={{ padding: '1rem', fontSize: '0.8125rem', color: 'var(--text-muted)' }}>{new Date(entry.timestamp).toLocaleString()}</td>
                            <td style={{ padding: '1rem' }}>
                              <span style={{ padding: '0.25rem 0.5rem', borderRadius: '4px', fontSize: '0.75rem', fontWeight: 600,
                                background: entry.action.includes('Clock') ? 'rgba(16,185,129,0.1)' : entry.action === 'Deleted' ? 'rgba(239,68,68,0.1)' : 'rgba(245,158,11,0.1)',
                                color: entry.action.includes('Clock') ? 'var(--success)' : entry.action === 'Deleted' ? 'var(--danger)' : 'var(--warning)'
                              }}>{entry.action}</span>
                            </td>
                            <td style={{ padding: '1rem', fontSize: '0.875rem' }}>{entry.entityType}</td>
                            <td style={{ padding: '1rem', fontSize: '0.875rem', fontWeight: 500 }}>{entry.entityName}</td>
                            <td style={{ padding: '1rem', fontSize: '0.8125rem', color: 'var(--text-muted)' }}>{entry.details}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}
              </div>
            )}

            {/* Settings View */}
            {view === 'settings' && (
              <div style={{ maxWidth: '600px', margin: '0 auto' }}>
                <h2 style={{ fontSize: '1.5rem', fontWeight: 700, marginBottom: '1.5rem' }}>Settings</h2>


                {/* Business Settings */}
                <section style={{ background: 'var(--bg-secondary)', borderRadius: '16px', padding: '1.5rem', border: '1px solid var(--border)', marginBottom: '1.5rem' }}>
                  <h3 style={{ fontSize: '1rem', fontWeight: 600, marginBottom: '1rem' }}>Business</h3>
                  <Input label="Business Name" value={settings.businessName} onChange={(v) => setSettings({ ...settings, businessName: v })} placeholder="Your Business" style={{ marginBottom: '1rem' }} />
                  <label style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', cursor: 'pointer' }}>
                    <input type="checkbox" checked={settings.requireJob} onChange={(e) => setSettings({ ...settings, requireJob: e.target.checked })} style={{ width: 18, height: 18 }} />
                    <span style={{ fontSize: '0.9375rem' }}>Require job selection when clocking in</span>
                  </label>
                </section>

                {/* Data */}
                <section style={{ background: 'var(--bg-secondary)', borderRadius: '16px', padding: '1.5rem', border: '1px solid var(--border)' }}>
                  <h3 style={{ fontSize: '1rem', fontWeight: 600, marginBottom: '1rem' }}>Data Management</h3>
                  <div style={{ display: 'flex', gap: '0.75rem', flexWrap: 'wrap' }}>
                    <Button variant="secondary" onClick={exportData}><Icons.Download /> Export Backup</Button>
                    <Button variant="secondary" onClick={() => fileInputRef.current?.click()}><Icons.Upload /> Import Backup</Button>
                    <input ref={fileInputRef} type="file" accept=".json" onChange={importData} style={{ display: 'none' }} />
                  </div>
                </section>
              </div>
            )}
          </main>

          {/* Demo Watermark */}

          {/* Footer */}
          <HelpModal isOpen={showHelp} onClose={() => setShowHelp(false)} />
          <footer style={{ textAlign: 'center', padding: '1.5rem', borderTop: '1px solid var(--border)', color: 'var(--text-muted)', fontSize: '0.75rem' }}>
            {settings.businessName || 'CrewClock'} ‚Ä¢ v2.0.1
          </footer>

          {/* Employee Modal */}
          <Modal isOpen={showEmployeeModal} onClose={() => { setShowEmployeeModal(false); setEditingEmployee(null); }} title={editingEmployee ? 'Edit Employee' : 'Add Employee'}>
            {(() => {
              const [form, setForm] = useState(editingEmployee || { name: '', pin: '', role: 'Staff', hourlyRate: 15, active: true });
              useEffect(() => { setForm(editingEmployee || { name: '', pin: '', role: 'Staff', hourlyRate: 15, active: true }); }, [editingEmployee]);
              return (
                <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                  <Input label="Name" value={form.name} onChange={(v) => setForm({ ...form, name: v })} required />
                  <Input label="PIN (4 digits)" value={form.pin} onChange={(v) => setForm({ ...form, pin: v.slice(0, 4) })} placeholder="1234" required />
                  <Input label="Role" value={form.role} onChange={(v) => setForm({ ...form, role: v })} />
                  <Input label="Hourly Rate ($)" type="number" value={form.hourlyRate} onChange={(v) => setForm({ ...form, hourlyRate: parseFloat(v) || 0 })} />
                  <label style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                    <input type="checkbox" checked={form.active} onChange={(e) => setForm({ ...form, active: e.target.checked })} />
                    <span>Active</span>
                  </label>
                  <div style={{ display: 'flex', gap: '0.75rem', marginTop: '0.5rem' }}>
                    <Button variant="secondary" onClick={() => { setShowEmployeeModal(false); setEditingEmployee(null); }} style={{ flex: 1 }}>Cancel</Button>
                    <Button onClick={() => saveEmployee({ ...form, id: editingEmployee?.id || generateId() })} style={{ flex: 1 }} disabled={!form.name || !form.pin}>Save</Button>
                  </div>
                </div>
              );
            })()}
          </Modal>

          {/* Job Modal */}
          <Modal isOpen={showJobModal} onClose={() => { setShowJobModal(false); setEditingJob(null); }} title={editingJob ? 'Edit Job' : 'Add Job'}>
            {(() => {
              const [form, setForm] = useState(editingJob || { name: '', code: '', active: true });
              useEffect(() => { setForm(editingJob || { name: '', code: '', active: true });
      // Backup & Restore
      const backupAllData = () => {
        const data = { employees, entries, settings, exportedAt: new Date().toISOString() };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `crewclock-backup-\${new Date().toISOString().split('T')[0]}.json`;
        a.click();
      };
      
      const restoreAllData = (e) => {
        const file = e.target.files?.[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          try {
            const data = JSON.parse(ev.target.result);
            if (data.employees) { setEmployees(data.employees); save('employees', data.employees); }
            if (data.entries) { setEntries(data.entries); save('entries', data.entries); }
            if (data.settings) { setSettings(data.settings); save('settings', data.settings); }
            alert('Data restored successfully!');
            window.location.reload();
          } catch (err) { alert('Invalid backup file'); }
        };
        reader.readAsText(file);
      };
 }, [editingJob]);
              return (
                <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                  <Input label="Job Name" value={form.name} onChange={(v) => setForm({ ...form, name: v })} required />
                  <Input label="Job Code" value={form.code} onChange={(v) => setForm({ ...form, code: v.toUpperCase() })} placeholder="MAINT" />
                  <label style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                    <input type="checkbox" checked={form.active} onChange={(e) => setForm({ ...form, active: e.target.checked })} />
                    <span>Active</span>
                  </label>
                  <div style={{ display: 'flex', gap: '0.75rem', marginTop: '0.5rem' }}>
                    <Button variant="secondary" onClick={() => { setShowJobModal(false); setEditingJob(null); }} style={{ flex: 1 }}>Cancel</Button>
                    <Button onClick={() => saveJob({ ...form, id: editingJob?.id || generateId() })} style={{ flex: 1 }} disabled={!form.name}>Save</Button>
                  </div>
                </div>
              );
            })()}
          </Modal>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);

    // Service Worker
    if ('serviceWorker' in navigator) {
      const sw = `const C='crewclock-v1';self.addEventListener('install',()=>self.skipWaiting());self.addEventListener('activate',e=>e.waitUntil(clients.claim()));self.addEventListener('fetch',e=>e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).catch(()=>caches.match('/')))));`;
      navigator.serviceWorker.register(URL.createObjectURL(new Blob([sw], { type: 'application/javascript' })), { scope: '/' }).catch(() => {});
    }
  </script>
</body>
</html>
