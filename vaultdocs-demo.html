<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VaultDocs - Demo</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      --primary: #4f46e5;
      --primary-dark: #4338ca;
      --primary-light: #eef2ff;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--gray-100);
      color: var(--gray-800);
      line-height: 1.5;
    }
    
    .header {
      background: var(--primary);
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header h1 { font-size: 1.5rem; font-weight: 600; }
    
    .demo-badge {
      background: var(--warning);
      color: var(--gray-800);
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .layout {
      display: flex;
      min-height: calc(100vh - 60px);
    }
    
    .sidebar {
      width: 250px;
      background: white;
      border-right: 1px solid var(--gray-200);
      padding: 1rem 0;
      flex-shrink: 0;
    }
    
    .sidebar-section {
      padding: 0.5rem 1rem;
      margin-bottom: 1rem;
    }
    
    .sidebar-title {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--gray-500);
      text-transform: uppercase;
      margin-bottom: 0.5rem;
    }
    
    .sidebar-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 1rem;
      cursor: pointer;
      border-radius: 0.375rem;
      margin: 0.125rem 0.5rem;
      font-size: 0.875rem;
    }
    
    .sidebar-item:hover { background: var(--gray-100); }
    .sidebar-item.active { background: var(--primary-light); color: var(--primary); font-weight: 500; }
    
    .sidebar-item-icon { font-size: 1.125rem; }
    .sidebar-item-count { margin-left: auto; font-size: 0.75rem; color: var(--gray-400); }
    
    .folder-tree { margin-left: 1rem; }
    
    .folder-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.375rem 0.75rem;
      cursor: pointer;
      border-radius: 0.25rem;
      font-size: 0.875rem;
    }
    
    .folder-item:hover { background: var(--gray-100); }
    .folder-item.active { background: var(--primary-light); color: var(--primary); }
    
    .main-content {
      flex: 1;
      padding: 1.5rem;
      overflow-y: auto;
    }
    
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .toolbar-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
    }
    
    .breadcrumb-item { color: var(--gray-500); cursor: pointer; }
    .breadcrumb-item:hover { color: var(--primary); }
    .breadcrumb-separator { color: var(--gray-400); }
    .breadcrumb-current { font-weight: 600; color: var(--gray-800); }
    
    .search-box {
      display: flex;
      align-items: center;
      background: white;
      border: 1px solid var(--gray-300);
      border-radius: 0.375rem;
      padding: 0.5rem 0.75rem;
      width: 300px;
    }
    
    .search-box input {
      border: none;
      outline: none;
      flex: 1;
      font-size: 0.875rem;
    }
    
    .search-box-icon { color: var(--gray-400); margin-right: 0.5rem; }
    
    .toolbar-right { display: flex; gap: 0.5rem; }
    
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      font-weight: 500;
      cursor: pointer;
      border: none;
      font-size: 0.875rem;
    }
    
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-secondary { background: var(--gray-200); color: var(--gray-700); }
    .btn-danger { background: var(--danger); color: white; }
    .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.75rem; }
    
    .view-toggle {
      display: flex;
      background: var(--gray-200);
      border-radius: 0.375rem;
      overflow: hidden;
    }
    
    .view-toggle button {
      padding: 0.5rem 0.75rem;
      border: none;
      background: transparent;
      cursor: pointer;
    }
    
    .view-toggle button.active { background: white; }
    
    .file-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem;
    }
    
    .file-card {
      background: white;
      border: 1px solid var(--gray-200);
      border-radius: 0.5rem;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .file-card:hover {
      border-color: var(--primary);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .file-card.selected {
      border-color: var(--primary);
      background: var(--primary-light);
    }
    
    .file-icon {
      font-size: 3rem;
      text-align: center;
      margin-bottom: 0.75rem;
    }
    
    .file-name {
      font-weight: 500;
      font-size: 0.875rem;
      text-align: center;
      word-break: break-word;
      margin-bottom: 0.25rem;
    }
    
    .file-meta {
      font-size: 0.75rem;
      color: var(--gray-500);
      text-align: center;
    }
    
    .file-list {
      background: white;
      border-radius: 0.5rem;
      overflow: hidden;
    }
    
    .file-list-header {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr 100px;
      padding: 0.75rem 1rem;
      background: var(--gray-50);
      border-bottom: 1px solid var(--gray-200);
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--gray-500);
      text-transform: uppercase;
    }
    
    .file-list-row {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr 100px;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--gray-100);
      align-items: center;
      cursor: pointer;
    }
    
    .file-list-row:hover { background: var(--gray-50); }
    .file-list-row.selected { background: var(--primary-light); }
    
    .file-list-name {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 0.875rem;
    }
    
    .file-list-name span { font-size: 1.25rem; }
    
    .tag {
      display: inline-block;
      padding: 0.125rem 0.5rem;
      background: var(--gray-200);
      border-radius: 9999px;
      font-size: 0.7rem;
      margin-right: 0.25rem;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .stat-card {
      background: white;
      padding: 1rem;
      border-radius: 0.5rem;
      text-align: center;
    }
    
    .stat-value { font-size: 1.5rem; font-weight: 700; color: var(--primary); }
    .stat-label { font-size: 0.75rem; color: var(--gray-500); }
    
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal-overlay.active { display: flex; }
    
    .modal {
      background: white;
      border-radius: 0.5rem;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--gray-200);
    }
    
    .modal-title { font-size: 1.125rem; font-weight: 600; }
    .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray-400); }
    .modal-body { padding: 1.5rem; }
    
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--gray-200);
      background: var(--gray-50);
    }
    
    .form-group { margin-bottom: 1rem; }
    .form-label { display: block; font-weight: 500; margin-bottom: 0.5rem; font-size: 0.875rem; }
    
    .form-input {
      width: 100%;
      padding: 0.625rem 0.75rem;
      border: 1px solid var(--gray-300);
      border-radius: 0.375rem;
      font-size: 0.875rem;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }
    
    .upload-zone {
      border: 2px dashed var(--gray-300);
      border-radius: 0.5rem;
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .upload-zone:hover {
      border-color: var(--primary);
      background: var(--primary-light);
    }
    
    .upload-zone-icon { font-size: 3rem; margin-bottom: 0.5rem; }
    .upload-zone-text { color: var(--gray-600); }
    
    .detail-panel {
      background: white;
      border-radius: 0.5rem;
      padding: 1.5rem;
    }
    
    .detail-header {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--gray-200);
    }
    
    .detail-icon { font-size: 3rem; }
    .detail-name { font-size: 1.25rem; font-weight: 600; word-break: break-word; }
    .detail-type { font-size: 0.875rem; color: var(--gray-500); }
    
    .detail-section { margin-bottom: 1.5rem; }
    .detail-section-title { font-weight: 600; margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--gray-600); }
    
    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0;
      font-size: 0.875rem;
      border-bottom: 1px solid var(--gray-100);
    }
    
    .detail-row:last-child { border-bottom: none; }
    .detail-label { color: var(--gray-500); }
    
    .version-list { margin-top: 0.5rem; }
    
    .version-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem;
      background: var(--gray-50);
      border-radius: 0.25rem;
      margin-bottom: 0.25rem;
      font-size: 0.875rem;
    }
    
    .version-current { background: var(--primary-light); }
    
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--gray-500);
    }
    
    .empty-state-icon { font-size: 4rem; margin-bottom: 1rem; opacity: 0.5; }
    
    .toast-container { position: fixed; bottom: 1rem; right: 1rem; z-index: 2000; }
    
    .toast {
      background: var(--gray-800);
      color: white;
      padding: 0.75rem 1rem;
      border-radius: 0.375rem;
      margin-top: 0.5rem;
      animation: slideIn 0.3s ease;
    }
    
    .toast.success { background: var(--success); }
    .toast.error { background: var(--danger); }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .context-menu {
      position: fixed;
      background: white;
      border-radius: 0.375rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1001;
      min-width: 150px;
      display: none;
    }
    
    .context-menu.active { display: block; }
    
    .context-menu-item {
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-size: 0.875rem;
    }
    
    .context-menu-item:hover { background: var(--gray-100); }
    .context-menu-item.danger { color: var(--danger); }
    
    @media (max-width: 768px) {
      .sidebar { display: none; }
      .file-list-header, .file-list-row { grid-template-columns: 1fr auto; }
      .file-list-header > *:nth-child(n+2):nth-child(-n+4),
      .file-list-row > *:nth-child(n+2):nth-child(-n+4) { display: none; }
    }
  </style>
</head>
<body>
  <header class="header">
    <h1>ğŸ“ VaultDocs</h1>
    <span class="demo-badge">Demo Mode</span>
  </header>
  
  <div class="layout">
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-item active" data-view="all" onclick="setView('all')">
          <span class="sidebar-item-icon">ğŸ“„</span>
          <span>All Files</span>
          <span class="sidebar-item-count" id="count-all">0</span>
        </div>
        <div class="sidebar-item" data-view="recent" onclick="setView('recent')">
          <span class="sidebar-item-icon">ğŸ•</span>
          <span>Recent</span>
        </div>
        <div class="sidebar-item" data-view="starred" onclick="setView('starred')">
          <span class="sidebar-item-icon">â­</span>
          <span>Starred</span>
          <span class="sidebar-item-count" id="count-starred">0</span>
        </div>
        <div class="sidebar-item" data-view="shared" onclick="setView('shared')">
          <span class="sidebar-item-icon">ğŸ”—</span>
          <span>Shared</span>
          <span class="sidebar-item-count" id="count-shared">0</span>
        </div>
        <div class="sidebar-item" data-view="trash" onclick="setView('trash')">
          <span class="sidebar-item-icon">ğŸ—‘ï¸</span>
          <span>Trash</span>
          <span class="sidebar-item-count" id="count-trash">0</span>
        </div>
      </div>
      
      <div class="sidebar-section">
        <div class="sidebar-title">Folders</div>
        <div id="folder-tree"></div>
        <div class="sidebar-item" onclick="openFolderModal()" style="color: var(--primary);">
          <span class="sidebar-item-icon">â•</span>
          <span>New Folder</span>
        </div>
      </div>
      
      <div class="sidebar-section">
        <div class="sidebar-title">Storage</div>
        <div style="padding: 0 1rem;">
          <div style="display: flex; justify-content: space-between; font-size: 0.75rem; margin-bottom: 0.25rem;">
            <span id="storage-used">0 MB</span>
            <span>100 MB</span>
          </div>
          <div style="height: 6px; background: var(--gray-200); border-radius: 3px;">
            <div id="storage-bar" style="height: 100%; background: var(--primary); border-radius: 3px; width: 0%;"></div>
          </div>
        </div>
      </div>
    </aside>
    
    <main class="main-content">
      <div class="toolbar">
        <div class="toolbar-left">
          <div class="breadcrumb" id="breadcrumb">
            <span class="breadcrumb-current">All Files</span>
          </div>
        </div>
        <div class="search-box">
          <span class="search-box-icon">ğŸ”</span>
          <input type="text" placeholder="Search files..." id="search-input" oninput="searchFiles()">
        </div>
        <div class="toolbar-right">
          <div class="view-toggle">
            <button class="active" onclick="setDisplayMode('grid')" id="view-grid">â–¦</button>
            <button onclick="setDisplayMode('list')" id="view-list">â˜°</button>
          </div>
          <button class="btn btn-primary" onclick="openUploadModal()">+ Upload</button>
        </div>
      </div>
      
      <div id="file-container"></div>
    </main>
  </div>
  
  <!-- Upload Modal -->
  <div class="modal-overlay" id="upload-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Upload Files</h3>
        <button class="modal-close" onclick="closeModal('upload-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="upload-zone" onclick="document.getElementById('file-input').click()">
          <div class="upload-zone-icon">ğŸ“¤</div>
          <div class="upload-zone-text">Click to select files or drag and drop</div>
          <div style="font-size: 0.75rem; color: var(--gray-400); margin-top: 0.5rem;">Demo: Files are simulated</div>
        </div>
        <input type="file" id="file-input" multiple style="display:none" onchange="handleFileSelect(event)">
        
        <div class="form-group" style="margin-top: 1rem;">
          <label class="form-label">Upload to Folder</label>
          <select class="form-input" id="upload-folder">
            <option value="">Root</option>
          </select>
        </div>
        
        <div id="upload-preview" style="margin-top: 1rem;"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('upload-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="uploadFiles()">Upload</button>
      </div>
    </div>
  </div>
  
  <!-- Folder Modal -->
  <div class="modal-overlay" id="folder-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="folder-modal-title">New Folder</h3>
        <button class="modal-close" onclick="closeModal('folder-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="folder-id">
        <div class="form-group">
          <label class="form-label">Folder Name *</label>
          <input type="text" class="form-input" id="folder-name" placeholder="e.g., Projects">
        </div>
        <div class="form-group">
          <label class="form-label">Parent Folder</label>
          <select class="form-input" id="folder-parent">
            <option value="">Root</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" id="folder-delete-btn" onclick="deleteFolder()" style="margin-right:auto;display:none;">Delete</button>
        <button class="btn btn-secondary" onclick="closeModal('folder-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveFolder()">Save</button>
      </div>
    </div>
  </div>
  
  <!-- File Detail Modal -->
  <div class="modal-overlay" id="detail-modal">
    <div class="modal" style="max-width: 600px;">
      <div class="modal-header">
        <h3 class="modal-title">File Details</h3>
        <button class="modal-close" onclick="closeModal('detail-modal')">&times;</button>
      </div>
      <div class="modal-body" id="detail-content"></div>
      <div class="modal-footer" id="detail-footer"></div>
    </div>
  </div>
  
  <!-- Rename Modal -->
  <div class="modal-overlay" id="rename-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Rename</h3>
        <button class="modal-close" onclick="closeModal('rename-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="rename-id">
        <div class="form-group">
          <label class="form-label">New Name</label>
          <input type="text" class="form-input" id="rename-name">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('rename-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveRename()">Rename</button>
      </div>
    </div>
  </div>
  
  <!-- Context Menu -->
  <div class="context-menu" id="context-menu">
    <div class="context-menu-item" onclick="openFile()">ğŸ“‚ Open</div>
    <div class="context-menu-item" onclick="renameFile()">âœï¸ Rename</div>
    <div class="context-menu-item" onclick="toggleStar()">â­ Star/Unstar</div>
    <div class="context-menu-item" onclick="shareFile()">ğŸ”— Share</div>
    <div class="context-menu-item" onclick="downloadFile()">â¬‡ï¸ Download</div>
    <div class="context-menu-item" onclick="moveToTrash()">ğŸ—‘ï¸ Move to Trash</div>
  </div>
  
  <div class="toast-container" id="toast-container"></div>

  <script>
    let files = [], folders = [];
    let currentView = 'all';
    let currentFolder = null;
    let displayMode = 'grid';
    let selectedFile = null;
    let searchQuery = '';
    let pendingUploads = [];
    
    const FILE_TYPES = {
      pdf: { icon: 'ğŸ“•', color: '#ef4444' },
      doc: { icon: 'ğŸ“˜', color: '#2563eb' },
      docx: { icon: 'ğŸ“˜', color: '#2563eb' },
      xls: { icon: 'ğŸ“—', color: '#10b981' },
      xlsx: { icon: 'ğŸ“—', color: '#10b981' },
      ppt: { icon: 'ğŸ“™', color: '#f59e0b' },
      pptx: { icon: 'ğŸ“™', color: '#f59e0b' },
      jpg: { icon: 'ğŸ–¼ï¸', color: '#8b5cf6' },
      jpeg: { icon: 'ğŸ–¼ï¸', color: '#8b5cf6' },
      png: { icon: 'ğŸ–¼ï¸', color: '#8b5cf6' },
      gif: { icon: 'ğŸ–¼ï¸', color: '#8b5cf6' },
      txt: { icon: 'ğŸ“', color: '#6b7280' },
      zip: { icon: 'ğŸ“¦', color: '#78716c' },
      default: { icon: 'ğŸ“„', color: '#6b7280' }
    };
    
    function init() {
      loadData();
      renderAll();
      document.addEventListener('click', hideContextMenu);
    }
    
    function loadData() {
      const saved = {
        files: localStorage.getItem('vaultdocs_files'),
        folders: localStorage.getItem('vaultdocs_folders')
      };
      
      folders = saved.folders ? JSON.parse(saved.folders) : [
        { id: 1, name: 'Projects', parentId: null, created: '2024-01-15' },
        { id: 2, name: 'Contracts', parentId: null, created: '2024-02-01' },
        { id: 3, name: 'Marketing', parentId: null, created: '2024-03-10' },
        { id: 4, name: '2024 Campaign', parentId: 3, created: '2024-03-15' },
      ];
      
      files = saved.files ? JSON.parse(saved.files) : [
        { id: 1, name: 'Project Proposal.pdf', type: 'pdf', size: 2456000, folderId: 1, starred: true, shared: false, trash: false, created: '2024-06-15', modified: '2024-06-20', versions: [{v: 1, date: '2024-06-15'}, {v: 2, date: '2024-06-20'}] },
        { id: 2, name: 'Budget 2024.xlsx', type: 'xlsx', size: 156000, folderId: 1, starred: false, shared: true, trash: false, created: '2024-05-10', modified: '2024-07-01', versions: [{v: 1, date: '2024-05-10'}] },
        { id: 3, name: 'Service Agreement.docx', type: 'docx', size: 89000, folderId: 2, starred: true, shared: false, trash: false, created: '2024-04-01', modified: '2024-04-15', versions: [{v: 1, date: '2024-04-01'}] },
        { id: 4, name: 'NDA Template.pdf', type: 'pdf', size: 125000, folderId: 2, starred: false, shared: true, trash: false, created: '2024-03-20', modified: '2024-03-20', versions: [{v: 1, date: '2024-03-20'}] },
        { id: 5, name: 'Brand Guidelines.pdf', type: 'pdf', size: 4500000, folderId: 3, starred: false, shared: false, trash: false, created: '2024-03-12', modified: '2024-03-12', versions: [{v: 1, date: '2024-03-12'}] },
        { id: 6, name: 'Social Media Plan.pptx', type: 'pptx', size: 3200000, folderId: 4, starred: true, shared: true, trash: false, created: '2024-03-18', modified: '2024-04-05', versions: [{v: 1, date: '2024-03-18'}, {v: 2, date: '2024-04-05'}] },
        { id: 7, name: 'Meeting Notes.txt', type: 'txt', size: 12000, folderId: null, starred: false, shared: false, trash: false, created: '2024-07-10', modified: '2024-07-10', versions: [{v: 1, date: '2024-07-10'}] },
        { id: 8, name: 'Logo.png', type: 'png', size: 850000, folderId: 3, starred: false, shared: false, trash: false, created: '2024-03-11', modified: '2024-03-11', versions: [{v: 1, date: '2024-03-11'}] },
        { id: 9, name: 'Old Report.pdf', type: 'pdf', size: 560000, folderId: null, starred: false, shared: false, trash: true, created: '2024-01-05', modified: '2024-01-05', versions: [{v: 1, date: '2024-01-05'}] },
      ];
      
      saveData();
    }
    
    function saveData() {
      localStorage.setItem('vaultdocs_files', JSON.stringify(files));
      localStorage.setItem('vaultdocs_folders', JSON.stringify(folders));
    }
    
    function renderAll() {
      renderFolderTree();
      renderFiles();
      updateCounts();
      updateStorage();
      updateFolderSelects();
    }
    
    function renderFolderTree() {
      const tree = document.getElementById('folder-tree');
      const rootFolders = folders.filter(f => !f.parentId);
      
      tree.innerHTML = rootFolders.map(f => renderFolderItem(f)).join('');
    }
    
    function renderFolderItem(folder) {
      const children = folders.filter(f => f.parentId === folder.id);
      const isActive = currentFolder === folder.id;
      
      return `
        <div class="folder-item${isActive ? ' active' : ''}" onclick="openFolder(${folder.id})" oncontextmenu="showFolderContext(event, ${folder.id})">
          <span>ğŸ“</span>
          <span>${folder.name}</span>
        </div>
        ${children.length ? `<div class="folder-tree">${children.map(c => renderFolderItem(c)).join('')}</div>` : ''}
      `;
    }
    
    function renderFiles() {
      const container = document.getElementById('file-container');
      let displayFiles = getFilteredFiles();
      
      // Apply search
      if (searchQuery) {
        displayFiles = displayFiles.filter(f => f.name.toLowerCase().includes(searchQuery.toLowerCase()));
      }
      
      // Add folders if in folder view or all files view
      let displayFolders = [];
      if ((currentView === 'all' || currentView === 'folder') && !searchQuery) {
        displayFolders = folders.filter(f => f.parentId === currentFolder);
      }
      
      if (displayFiles.length === 0 && displayFolders.length === 0) {
        container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">ğŸ“‚</div><p>No files here</p></div>`;
        return;
      }
      
      if (displayMode === 'grid') {
        container.innerHTML = `<div class="file-grid">
          ${displayFolders.map(f => `
            <div class="file-card" ondblclick="openFolder(${f.id})" oncontextmenu="showFolderContext(event, ${f.id})">
              <div class="file-icon">ğŸ“</div>
              <div class="file-name">${f.name}</div>
              <div class="file-meta">${countFolderItems(f.id)} items</div>
            </div>
          `).join('')}
          ${displayFiles.map(f => {
            const type = FILE_TYPES[f.type] || FILE_TYPES.default;
            return `<div class="file-card${selectedFile === f.id ? ' selected' : ''}" 
              onclick="selectFile(${f.id})" 
              ondblclick="openFileDetail(${f.id})"
              oncontextmenu="showContextMenu(event, ${f.id})">
              <div class="file-icon">${type.icon}</div>
              <div class="file-name">${f.name}</div>
              <div class="file-meta">${formatSize(f.size)}${f.starred ? ' â­' : ''}${f.shared ? ' ğŸ”—' : ''}</div>
            </div>`;
          }).join('')}
        </div>`;
      } else {
        container.innerHTML = `<div class="file-list">
          <div class="file-list-header">
            <div>Name</div>
            <div>Size</div>
            <div>Modified</div>
            <div>Type</div>
            <div>Actions</div>
          </div>
          ${displayFolders.map(f => `
            <div class="file-list-row" ondblclick="openFolder(${f.id})" oncontextmenu="showFolderContext(event, ${f.id})">
              <div class="file-list-name"><span>ğŸ“</span>${f.name}</div>
              <div>${countFolderItems(f.id)} items</div>
              <div>${formatDate(f.created)}</div>
              <div>Folder</div>
              <div></div>
            </div>
          `).join('')}
          ${displayFiles.map(f => {
            const type = FILE_TYPES[f.type] || FILE_TYPES.default;
            return `<div class="file-list-row${selectedFile === f.id ? ' selected' : ''}" 
              onclick="selectFile(${f.id})" 
              ondblclick="openFileDetail(${f.id})"
              oncontextmenu="showContextMenu(event, ${f.id})">
              <div class="file-list-name"><span>${type.icon}</span>${f.name}${f.starred ? ' â­' : ''}${f.shared ? ' ğŸ”—' : ''}</div>
              <div>${formatSize(f.size)}</div>
              <div>${formatDate(f.modified)}</div>
              <div>${f.type.toUpperCase()}</div>
              <div><button class="btn btn-sm btn-secondary" onclick="event.stopPropagation();openFileDetail(${f.id})">Details</button></div>
            </div>`;
          }).join('')}
        </div>`;
      }
    }
    
    function getFilteredFiles() {
      let filtered = files.filter(f => !f.trash);
      
      switch (currentView) {
        case 'all':
          filtered = filtered.filter(f => f.folderId === currentFolder);
          break;
        case 'recent':
          filtered = [...filtered].sort((a, b) => new Date(b.modified) - new Date(a.modified)).slice(0, 20);
          break;
        case 'starred':
          filtered = filtered.filter(f => f.starred);
          break;
        case 'shared':
          filtered = filtered.filter(f => f.shared);
          break;
        case 'trash':
          filtered = files.filter(f => f.trash);
          break;
        case 'folder':
          filtered = filtered.filter(f => f.folderId === currentFolder);
          break;
      }
      
      return filtered;
    }
    
    function countFolderItems(folderId) {
      const subFolders = folders.filter(f => f.parentId === folderId).length;
      const fileCount = files.filter(f => f.folderId === folderId && !f.trash).length;
      return subFolders + fileCount;
    }
    
    function setView(view) {
      currentView = view;
      currentFolder = null;
      selectedFile = null;
      
      document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
      document.querySelector(`.sidebar-item[data-view="${view}"]`).classList.add('active');
      document.querySelectorAll('.folder-item').forEach(el => el.classList.remove('active'));
      
      updateBreadcrumb();
      renderFiles();
    }
    
    function openFolder(folderId) {
      currentView = 'folder';
      currentFolder = folderId;
      selectedFile = null;
      
      document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.folder-item').forEach(el => el.classList.remove('active'));
      
      updateBreadcrumb();
      renderFiles();
      renderFolderTree();
    }
    
    function updateBreadcrumb() {
      const bc = document.getElementById('breadcrumb');
      
      if (currentView === 'folder' && currentFolder) {
        const path = getFolderPath(currentFolder);
        bc.innerHTML = `
          <span class="breadcrumb-item" onclick="setView('all')">All Files</span>
          ${path.map((f, i) => `
            <span class="breadcrumb-separator">/</span>
            ${i === path.length - 1 
              ? `<span class="breadcrumb-current">${f.name}</span>`
              : `<span class="breadcrumb-item" onclick="openFolder(${f.id})">${f.name}</span>`
            }
          `).join('')}
        `;
      } else {
        const titles = { all: 'All Files', recent: 'Recent', starred: 'Starred', shared: 'Shared', trash: 'Trash' };
        bc.innerHTML = `<span class="breadcrumb-current">${titles[currentView] || 'All Files'}</span>`;
      }
    }
    
    function getFolderPath(folderId) {
      const path = [];
      let current = folders.find(f => f.id === folderId);
      while (current) {
        path.unshift(current);
        current = folders.find(f => f.id === current.parentId);
      }
      return path;
    }
    
    function setDisplayMode(mode) {
      displayMode = mode;
      document.getElementById('view-grid').classList.toggle('active', mode === 'grid');
      document.getElementById('view-list').classList.toggle('active', mode === 'list');
      renderFiles();
    }
    
    function selectFile(id) {
      selectedFile = selectedFile === id ? null : id;
      renderFiles();
    }
    
    function searchFiles() {
      searchQuery = document.getElementById('search-input').value;
      renderFiles();
    }
    
    function updateCounts() {
      document.getElementById('count-all').textContent = files.filter(f => !f.trash).length;
      document.getElementById('count-starred').textContent = files.filter(f => f.starred && !f.trash).length;
      document.getElementById('count-shared').textContent = files.filter(f => f.shared && !f.trash).length;
      document.getElementById('count-trash').textContent = files.filter(f => f.trash).length;
    }
    
    function updateStorage() {
      const used = files.filter(f => !f.trash).reduce((sum, f) => sum + f.size, 0);
      const usedMB = (used / 1024 / 1024).toFixed(1);
      const pct = Math.min((used / (100 * 1024 * 1024)) * 100, 100);
      document.getElementById('storage-used').textContent = usedMB + ' MB';
      document.getElementById('storage-bar').style.width = pct + '%';
    }
    
    function updateFolderSelects() {
      const opts = '<option value="">Root</option>' + folders.map(f => `<option value="${f.id}">${getFolderPath(f.id).map(p => p.name).join(' / ')}</option>`).join('');
      document.getElementById('upload-folder').innerHTML = opts;
      document.getElementById('folder-parent').innerHTML = opts;
    }
    
    // Upload
    function openUploadModal() {
      pendingUploads = [];
      document.getElementById('upload-preview').innerHTML = '';
      document.getElementById('file-input').value = '';
      document.getElementById('upload-folder').value = currentFolder || '';
      document.getElementById('upload-modal').classList.add('active');
    }
    
    function handleFileSelect(e) {
      const fileList = e.target.files;
      pendingUploads = Array.from(fileList).map(f => ({
        name: f.name,
        size: f.size,
        type: f.name.split('.').pop().toLowerCase()
      }));
      
      document.getElementById('upload-preview').innerHTML = pendingUploads.map(f => `
        <div style="display:flex;align-items:center;gap:0.5rem;padding:0.5rem;background:var(--gray-50);border-radius:0.25rem;margin-bottom:0.25rem;">
          <span>${(FILE_TYPES[f.type] || FILE_TYPES.default).icon}</span>
          <span style="flex:1;font-size:0.875rem;">${f.name}</span>
          <span style="font-size:0.75rem;color:var(--gray-500);">${formatSize(f.size)}</span>
        </div>
      `).join('');
    }
    
    function uploadFiles() {
      if (pendingUploads.length === 0) {
        showToast('Please select files to upload', 'error');
        return;
      }
      
      const folderId = document.getElementById('upload-folder').value ? parseInt(document.getElementById('upload-folder').value) : null;
      const today = new Date().toISOString().split('T')[0];
      
      pendingUploads.forEach(f => {
        files.push({
          id: Math.max(0, ...files.map(x => x.id)) + 1,
          name: f.name,
          type: f.type,
          size: f.size,
          folderId: folderId,
          starred: false,
          shared: false,
          trash: false,
          created: today,
          modified: today,
          versions: [{ v: 1, date: today }]
        });
      });
      
      saveData();
      renderAll();
      closeModal('upload-modal');
      showToast(`${pendingUploads.length} file(s) uploaded`);
    }
    
    // Folders
    function openFolderModal(id = null) {
      if (id) {
        const folder = folders.find(f => f.id === id);
        document.getElementById('folder-modal-title').textContent = 'Edit Folder';
        document.getElementById('folder-id').value = id;
        document.getElementById('folder-name').value = folder.name;
        document.getElementById('folder-parent').value = folder.parentId || '';
        document.getElementById('folder-delete-btn').style.display = 'block';
      } else {
        document.getElementById('folder-modal-title').textContent = 'New Folder';
        document.getElementById('folder-id').value = '';
        document.getElementById('folder-name').value = '';
        document.getElementById('folder-parent').value = currentFolder || '';
        document.getElementById('folder-delete-btn').style.display = 'none';
      }
      document.getElementById('folder-modal').classList.add('active');
    }
    
    function saveFolder() {
      const id = document.getElementById('folder-id').value;
      const name = document.getElementById('folder-name').value.trim();
      const parentId = document.getElementById('folder-parent').value ? parseInt(document.getElementById('folder-parent').value) : null;
      
      if (!name) { showToast('Please enter folder name', 'error'); return; }
      
      if (id) {
        const i = folders.findIndex(f => f.id === parseInt(id));
        folders[i] = { ...folders[i], name, parentId };
        showToast('Folder updated');
      } else {
        folders.push({ id: Math.max(0, ...folders.map(f => f.id)) + 1, name, parentId, created: new Date().toISOString().split('T')[0] });
        showToast('Folder created');
      }
      
      saveData();
      renderAll();
      closeModal('folder-modal');
    }
    
    function deleteFolder() {
      const id = parseInt(document.getElementById('folder-id').value);
      const hasFiles = files.some(f => f.folderId === id);
      const hasSubfolders = folders.some(f => f.parentId === id);
      
      if (hasFiles || hasSubfolders) {
        showToast('Folder is not empty', 'error');
        return;
      }
      
      if (!confirm('Delete this folder?')) return;
      folders = folders.filter(f => f.id !== id);
      saveData();
      renderAll();
      closeModal('folder-modal');
      showToast('Folder deleted');
    }
    
    // Context Menu
    function showContextMenu(e, fileId) {
      e.preventDefault();
      selectedFile = fileId;
      const menu = document.getElementById('context-menu');
      menu.style.left = e.pageX + 'px';
      menu.style.top = e.pageY + 'px';
      menu.classList.add('active');
    }
    
    function showFolderContext(e, folderId) {
      e.preventDefault();
      e.stopPropagation();
      openFolderModal(folderId);
    }
    
    function hideContextMenu() {
      document.getElementById('context-menu').classList.remove('active');
    }
    
    function openFile() {
      if (!selectedFile) return;
      openFileDetail(selectedFile);
      hideContextMenu();
    }
    
    function openFileDetail(id) {
      const file = files.find(f => f.id === id);
      const type = FILE_TYPES[file.type] || FILE_TYPES.default;
      const folder = folders.find(f => f.id === file.folderId);
      
      document.getElementById('detail-content').innerHTML = `
        <div class="detail-header">
          <div class="detail-icon">${type.icon}</div>
          <div>
            <div class="detail-name">${file.name}</div>
            <div class="detail-type">${file.type.toUpperCase()} Document</div>
          </div>
        </div>
        
        <div class="detail-section">
          <div class="detail-section-title">Information</div>
          <div class="detail-row"><span class="detail-label">Size</span><span>${formatSize(file.size)}</span></div>
          <div class="detail-row"><span class="detail-label">Location</span><span>${folder ? folder.name : 'Root'}</span></div>
          <div class="detail-row"><span class="detail-label">Created</span><span>${formatDate(file.created)}</span></div>
          <div class="detail-row"><span class="detail-label">Modified</span><span>${formatDate(file.modified)}</span></div>
          <div class="detail-row"><span class="detail-label">Starred</span><span>${file.starred ? 'â­ Yes' : 'No'}</span></div>
          <div class="detail-row"><span class="detail-label">Shared</span><span>${file.shared ? 'ğŸ”— Yes' : 'No'}</span></div>
        </div>
        
        <div class="detail-section">
          <div class="detail-section-title">Version History</div>
          <div class="version-list">
            ${file.versions.map((v, i) => `
              <div class="version-item${i === file.versions.length - 1 ? ' version-current' : ''}">
                <span>Version ${v.v} - ${formatDate(v.date)}</span>
                ${i === file.versions.length - 1 ? '<span class="tag">Current</span>' : ''}
              </div>
            `).join('')}
          </div>
        </div>
      `;
      
      document.getElementById('detail-footer').innerHTML = `
        <button class="btn btn-secondary" onclick="toggleStarById(${id})">â­ ${file.starred ? 'Unstar' : 'Star'}</button>
        <button class="btn btn-secondary" onclick="toggleShareById(${id})">ğŸ”— ${file.shared ? 'Unshare' : 'Share'}</button>
        <button class="btn btn-primary" onclick="downloadById(${id})">â¬‡ï¸ Download</button>
      `;
      
      document.getElementById('detail-modal').classList.add('active');
    }
    
    function renameFile() {
      if (!selectedFile) return;
      const file = files.find(f => f.id === selectedFile);
      document.getElementById('rename-id').value = selectedFile;
      document.getElementById('rename-name').value = file.name;
      document.getElementById('rename-modal').classList.add('active');
      hideContextMenu();
    }
    
    function saveRename() {
      const id = parseInt(document.getElementById('rename-id').value);
      const name = document.getElementById('rename-name').value.trim();
      if (!name) { showToast('Please enter a name', 'error'); return; }
      
      const file = files.find(f => f.id === id);
      file.name = name;
      file.modified = new Date().toISOString().split('T')[0];
      
      saveData();
      renderAll();
      closeModal('rename-modal');
      showToast('File renamed');
    }
    
    function toggleStar() {
      if (!selectedFile) return;
      toggleStarById(selectedFile);
      hideContextMenu();
    }
    
    function toggleStarById(id) {
      const file = files.find(f => f.id === id);
      file.starred = !file.starred;
      saveData();
      renderAll();
      showToast(file.starred ? 'Added to starred' : 'Removed from starred');
    }
    
    function shareFile() {
      if (!selectedFile) return;
      toggleShareById(selectedFile);
      hideContextMenu();
    }
    
    function toggleShareById(id) {
      const file = files.find(f => f.id === id);
      file.shared = !file.shared;
      saveData();
      renderAll();
      closeModal('detail-modal');
      showToast(file.shared ? 'File shared (link copied)' : 'Sharing disabled');
    }
    
    function downloadFile() {
      if (!selectedFile) return;
      downloadById(selectedFile);
      hideContextMenu();
    }
    
    function downloadById(id) {
      const file = files.find(f => f.id === id);
      showToast(`Downloading ${file.name}...`);
    }
    
    function moveToTrash() {
      if (!selectedFile) return;
      const file = files.find(f => f.id === selectedFile);
      
      if (currentView === 'trash') {
        // Permanently delete
        if (!confirm('Permanently delete this file?')) return;
        files = files.filter(f => f.id !== selectedFile);
        showToast('File permanently deleted');
      } else {
        file.trash = true;
        showToast('Moved to trash');
      }
      
      selectedFile = null;
      saveData();
      renderAll();
      hideContextMenu();
    }
    
    // Helpers
    function formatSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / 1024 / 1024).toFixed(1) + ' MB';
    }
    
    function formatDate(dateStr) {
      return new Date(dateStr + 'T00:00:00').toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }
    
    function closeModal(id) {
      document.getElementById(id).classList.remove('active');
    }
    
    function showToast(msg, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = msg;
      document.getElementById('toast-container').appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }
    
    document.querySelectorAll('.modal-overlay').forEach(o => o.addEventListener('click', e => { if (e.target === o) o.classList.remove('active'); }));
    
    init();
  </script>
</body>
</html>
